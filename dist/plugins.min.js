define("charmap/charmap-plugin",["require","aloha","ui/ui","ui/button","aloha/plugin","jquery","jqueryui"],function(e){var t=e("aloha"),n=e("ui/ui"),r=e("ui/button"),i=e("aloha/plugin"),s=e("jquery");return e("jqueryui"),i.create("charmap",{width:480,height:410,$dialog:null,defaults:{charCodes:[38,34,162,8364,163,165,169,174,8482,8240,181,183,8226,8230,8242,8243,167,182,223,8249,8250,171,187,8216,8217,8220,8221,8218,8222,60,62,8804,8805,8211,8212,175,8254,164,166,168,161,191,710,732,176,8722,177,247,8260,215,185,178,179,188,189,190,402,8747,8721,8734,8730,8764,8773,8776,8800,8801,8712,8713,8715,8719,8743,8744,172,8745,8746,8706,8704,8707,8709,8711,8727,8733,8736,180,184,170,186,8224,8225,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,216,338,352,217,218,219,220,221,376,222,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,248,339,353,249,250,251,252,253,254,255,913,914,915,916,917,918,919,920,921,922,923,924,925,926,927,928,929,931,932,933,934,935,936,937,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960,961,962,963,964,965,966,967,968,969,8501,982,8476,977,978,8472,8465,8592,8593,8594,8595,8596,8629,8656,8657,8658,8659,8660,8756,8834,8835,8836,8838,8839,8853,8855,8869,8901,8968,8969,8970,8971,9001,9002,9674,9824,9827,9829,9830]},init:function(){this.settings=s.extend(!0,this.defaults,this.settings),this.$el=s('<div class="aloha-plugin-charmap"><div class="aloha-plugin-charmap-characters"><div class="aloha-plugin-charmap-preview"></div></div></div>'),this.createTable(),this.createDialog(),this.createButton(),this.subscribeEvents()},subscribeEvents:function(){var e=this;t.bind("aloha-editable-deactivated",function(){e.$dialog.dialog("close")})},createTable:function(){var e=this,t=s(".aloha-plugin-charmap-characters",this.$el),n=s(".aloha-plugin-charmap-preview",this.$el);s.each(this.settings.charCodes,function(r,i){var o="&#"+i+";";s('<a href="#">'+o+"</a>").click(function(){return e.onSelectCharacter(o),!1}).mouseenter(function(){n.html(o)}).mouseleave(function(){n.empty()}).appendTo(t)})},createDialog:function(){this.$dialog=this.$el.dialog({title:"Select special character",dialogClass:"aloha-plugin-charmap-dialog",modal:!1,resizable:!0,width:this.width,height:this.height,autoOpen:!1,zIndex:10101}),this.$dialog.dialog("widget").bind("mousedown",function(e){e.stopPropagation()}),this.$dialog.dialog("widget").draggable("option",{scroll:!1,containment:"window"}),this.$dialog.dialog("option","position",{my:"center",at:"center",of:window})},createButton:function(){var e=this;n.adopt("charmap",r,{tooltip:"Insert special character",icon:"aloha-icon aloha-plugin-charmap-button",scope:"Aloha.continuoustext",click:function(){e.$dialog.dialog("open")}})},onSelectCharacter:function(e){if(t.activeEditable){var n=t.Selection.rangeObject;n.select(),t.execCommand("insertHTML",!1,e),n.endContainer=n.startContainer,n.endOffset=++n.startOffset,n.select(),this.$dialog.dialog("close")}}})}),define("aptoma/lib/css",["require","aloha/rangy-core"],function(e){var t=e("aloha/rangy-core");return{createClassApplier:function(e,n,r){return n=n||{},n.applyToEditableOnly=!0,t.createCssClassApplier(e,n,r)}}}),define("aptoma/lib/range",["require","aloha","aloha/rangy-core"],function(e){var t=e("aloha"),n=e("aloha/rangy-core");return{rangeObjectToRangyRange:function(e){if(e.startOffset>e.startContainer.length)return console.warn("startOffset in range exceeds text length",e.startOffset,e.startContainer.length),!1;if(e.endOffset>e.endContainer.length)return console.warn("endOffset in range exceeds text length",e.endOffset,e.endContainer.length),!1;var t=n.createRange();return t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset),t},createExpandedRangeFromCollapsed:function(e){if(typeof e.startContainer=="undefined"||typeof e.endContainer=="undefined")return console.warn("can not select an empty range"),!1;var n=t.createRange();return n.setStart(e.startContainer,0),n.setEnd(e.endContainer,e.endContainer.length),n}}}),define("aptoma/lib/style",["require","jquery"],function(e){var t=e("jquery");return{getComputedStyle:function(e,n){return n=t.camelCase(n),e.currentStyle?e.currentStyle[n]:window.getComputedStyle?document.defaultView.getComputedStyle(e,null)[n]:null},hasStyle:function(e,t){return Boolean(e.style[t])},removeStyle:function(e,n){t(e).css(n,"").attr("style")||t(e).removeAttr("style")},removeClass:function(e,n){t(e).removeClass(n).attr("class")||t(e).removeAttr("class")},getClassNames:function(e){return String(t.trim(t(e).attr("class"))).split(" ")},getStyles:function(e,n){var r={},i=t(e).attr("style");return i&&i.split(";").forEach(function(e){var i=t.trim(e).split(":");r[n?t.camelCase(i[0]):i[0]]=i[1]}),r}}}),define("colorpicker/vendor/spectrum/spectrum",["jquery"],function(e){(function(e,t,n){function f(e,t,n){var r=[];for(var i=0;i<e.length;i++){var s=tinycolor(e[i]),u=s.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";u+=tinycolor.equals(t,e[i])?" sp-thumb-active":"";var a=o?"background-color:"+s.toRgbString():"filter:"+s.toFilter();r.push('<span title="'+s.toHexString()+'" data-color="'+s.toRgbString()+'" class="'+u+'"><span class="sp-thumb-inner" style="'+a+';" /></span>')}return"<div class='sp-cf "+n+"'>"+r.join("")+"</div>"}function l(){for(var e=0;e<i.length;e++)i[e]&&i[e].hide()}function c(e,n){var i=t.extend({},r,e);return i.callbacks={move:m(i.move,n),change:m(i.change,n),show:m(i.show,n),hide:m(i.hide,n),beforeShow:m(i.beforeShow,n)},i}function h(n,r){function yt(){function r(e){return e.data&&e.data.ignore?(Ot(t(this).data("color")),Dt()):(Ot(t(this).data("color")),Bt(!0),Dt(),Lt()),!1}s&&K.find("*:not(input)").attr("unselectable","on"),K.toggleClass("sp-flat",d),K.toggleClass("sp-input-disabled",!E),K.toggleClass("sp-alpha-enabled",S),K.toggleClass("sp-buttons-disabled",!h.showButtons||d),K.toggleClass("sp-palette-disabled",!b),K.toggleClass("sp-palette-only",m),K.toggleClass("sp-initial-disabled",!w),K.addClass(h.className),ft&&J.hide().after(lt),d?J.after(K).hide():t(V).append(K.hide());if(T&&e.localStorage)try{z=e.localStorage[T].split(",")}catch(n){}ct.bind("click.spectrum touchstart.spectrum",function(e){Ct(),e.stopPropagation(),t(e.target).is("input")||e.preventDefault()}),K.click(v),rt.change(Nt),rt.bind("paste",function(){setTimeout(Nt,1)}),rt.keydown(function(e){e.keyCode==13&&Nt()}),ot.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Lt("cancel")}),ut.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),_t()&&(Bt(!0),Lt())}),g(tt,function(e,t,n){q=e/P,n.shiftKey&&(q=Math.round(q*10)/10),Dt()}),g(Y,function(e,t){j=t/_,Dt()},xt,Tt),g(Q,function(e,t){F=e/A,I=(O-t)/O,Dt()},xt,Tt),pt?(Ot(pt),Pt(),mt=vt||tinycolor(pt).format,bt(pt)):Pt(),d&&kt();var i=s?"mousedown.spectrum":"click.spectrum touchstart.spectrum";it.delegate(".sp-thumb-el",i,r),st.delegate(".sp-thumb-el::nth-child(1)",i,{ignore:!0},r)}function bt(t){x&&(z.push(tinycolor(t).toHexString()),T&&e.localStorage&&(e.localStorage[T]=z.join(",")))}function wt(){var e=[],t=z,n={};if(b){for(var r=0;r<U.length;r++)for(var i=0;i<U[r].length;i++){var s=tinycolor(U[r][i]).toHexString();n[s]=!0}for(var r=0;r<t.length;r++){var o=tinycolor(t[r]),s=o.toHexString();n.hasOwnProperty(s)||(e.push(t[r]),n[s]=!0)}}return e.reverse().slice(0,h.maxSelectionSize)}function Et(){var e=Mt(),n=t.map(U,function(t,n){return f(t,e,"sp-palette-row sp-palette-row-"+n)});z&&n.push(f(wt(),e,"sp-palette-row sp-palette-row-selection")),it.html(n.join(""))}function St(){if(w){var e=dt,t=Mt();st.html(f([e,t],t,"sp-palette-row-initial"))}}function xt(){(O===0||A===0||_===0)&&jt(),K.addClass(W)}function Tt(){K.removeClass(W)}function Nt(){var e=tinycolor(rt.val());e.ok?Ot(e):rt.addClass("sp-validation-error")}function Ct(){L?Lt():kt()}function kt(){if(L){jt();return}if(C.beforeShow(Mt())===!1)return;l(),L=!0,t(X).bind("click.spectrum",Lt),t(e).bind("resize.spectrum",k),lt.addClass("sp-active"),K.show(),b&&Et(),jt(),Pt(),dt=Mt(),St(),C.show(dt)}function Lt(n){if(n&&n.type=="click"&&n.button==2)return;if(!L||d)return;L=!1,t(X).unbind("click.spectrum",Lt),t(e).unbind("resize.spectrum",k),lt.removeClass("sp-active"),K.hide();var r=!tinycolor.equals(Mt(),dt);r&&(gt&&n!=="cancel"?Bt(!0):At()),C.hide(Mt())}function At(){Ot(dt,!0)}function Ot(e,t){if(tinycolor.equals(e,Mt()))return;var n=tinycolor(e),r=n.toHsv();j=r.h,F=r.s,I=r.v,q=r.a,Pt(),t||(mt=vt||n.format)}function Mt(){return tinycolor.fromRatio({h:j,s:F,v:I,a:Math.round(q*100)/100})}function _t(){return!rt.hasClass("sp-validation-error")}function Dt(){Pt(),C.move(Mt())}function Pt(){rt.removeClass("sp-validation-error"),Ht();var e=tinycolor({h:j,s:"1.0",v:"1.0"});Q.css("background-color",e.toHexString());var t=mt;q<1&&(t==="hex"||t==="name")&&(t="rgb");var n=Mt(),r=n.toHexString(),i=n.toRgbString();o||n.alpha===1?ht.css("background-color",i):(ht.css("background-color","transparent"),ht.css("filter",n.toFilter()));if(S){var u=n.toRgb();u.a=0;var a=tinycolor(u).toRgbString(),f="linear-gradient(left, "+a+", "+r+")";s?et.css("filter",tinycolor(a).toFilter({gradientType:1},r)):(et.css("background","-webkit-"+f),et.css("background","-moz-"+f),et.css("background","-ms-"+f),et.css("background",f))}E&&(q<1&&(t==="hex"||t==="name")&&(t="rgb"),rt.val(n.toString(t))),b&&Et(),St()}function Ht(){var e=j,t=F,n=I,r=t*A,i=O-n*O;r=Math.max(-M,Math.min(A-M,r-M)),i=Math.max(-M,Math.min(O-M,i-M)),G.css({top:i,left:r});var s=q*P;nt.css({left:s-H/2});var o=j*_;Z.css({top:o-B})}function Bt(e){var t=Mt();at&&J.val(t.toString(mt)).change();var n=!tinycolor.equals(t,dt);dt=t,bt(t),e&&n&&C.change(t)}function jt(){A=Q.width(),O=Q.height(),M=G.height(),D=Y.width(),_=Y.height(),B=Z.height(),P=tt.width(),H=nt.width(),d||K.offset(p(K,ct)),Ht()}function Ft(){J.show(),ct.unbind("click.spectrum touchstart.spectrum"),K.remove(),lt.remove(),i[It.id]=null}var h=c(r,n),d=h.flat,m=h.showPaletteOnly,b=h.showPalette||m,w=h.showInitial&&!d,E=h.showInput,S=h.showAlpha,x=h.showSelectionPalette,T=h.localStorageKey,N=h.theme,C=h.callbacks,k=y(jt,10),L=!1,A=0,O=0,M=0,_=0,D=0,P=0,H=0,B=0,j=0,F=0,I=0,q=1,R=h.palette.slice(0),U=t.isArray(R[0])?R:[R],z=h.selectionPalette.slice(0),W="sp-dragging",X=n.ownerDocument,V=X.body,J=t(n),K=t(a,X).addClass(N),Q=K.find(".sp-color"),G=K.find(".sp-dragger"),Y=K.find(".sp-hue"),Z=K.find(".sp-slider"),et=K.find(".sp-alpha-inner"),tt=K.find(".sp-alpha"),nt=K.find(".sp-alpha-handle"),rt=K.find(".sp-input"),it=K.find(".sp-palette"),st=K.find(".sp-initial"),ot=K.find(".sp-cancel"),ut=K.find(".sp-choose"),at=J.is("input"),ft=at&&!d,lt=ft?t(u).addClass(N):t([]),ct=ft?lt:J,ht=lt.find(".sp-preview-inner"),pt=h.color||at&&J.val(),dt=!1,vt=h.preferredFormat,mt=vt,gt=!h.showButtons||h.clickoutFiresChange;ut.text(h.chooseText),ot.text(h.cancelText),yt();var It={show:kt,hide:Lt,toggle:Ct,reflow:jt,set:function(e){Ot(e),Bt()},get:Mt,destroy:Ft,container:K};return It.id=i.push(It)-1,It}function p(e,n){var r=0,i=e.outerWidth(),s=e.outerHeight(),o=n.outerWidth(),u=n.outerHeight(),a=e[0].ownerDocument,f=a.documentElement,l=f.clientWidth+t(a).scrollLeft(),c=f.clientHeight+t(a).scrollTop(),h=n.offset();return h.top+=u,h.left-=Math.min(h.left,h.left+i>l&&l>i?Math.abs(h.left+i-l):0),h.top-=Math.min(h.top,h.top+s>c&&c>s?Math.abs(s+u-r):r),h}function d(){}function v(e){e.stopPropagation()}function m(e,t){var n=Array.prototype.slice,r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}function g(n,r,i,o){function d(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function v(e){if(a){if(!(!s||document.documentMode>=9)&&!e.button)return g();var t=e.originalEvent.touches,i=t?t[0].pageX:e.pageX,o=t?t[0].pageY:e.pageY,u=Math.max(0,Math.min(i-f.left,c)),p=Math.max(0,Math.min(o-f.top,l));h&&d(e),r.apply(n,[u,p,e])}}function m(e){var r=e.which?e.which==3:e.button==2,s=e.originalEvent.touches;!r&&!a&&i.apply(n,arguments)!==!1&&(a=!0,l=t(n).height(),c=t(n).width(),f=t(n).offset(),t(u).bind(p),t(u.body).addClass("sp-dragging"),h||v(e),d(e))}function g(){a&&(t(u).unbind(p),t(u.body).removeClass("sp-dragging"),o.apply(n,arguments)),a=!1}r=r||function(){},i=i||function(){},o=o||function(){};var u=n.ownerDocument||document,a=!1,f={},l=0,c=0,h="ontouchstart"in e,p={};p.selectstart=d,p.dragstart=d,p[h?"touchmove":"mousemove"]=v,p[h?"touchend":"mouseup"]=g,t(n).bind(h?"touchstart":"mousedown",m)}function y(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}}var r={beforeShow:d,move:d,change:d,show:d,hide:d,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[]},i=[],s=!!/msie/i.exec(e.navigator.userAgent),o=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),n=t.style;return n.cssText="background-color:rgba(0,0,0,.5)",e(n.backgroundColor,"rgba")||e(n.backgroundColor,"hsla")}(),u=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),a=function(){var e="";if(s)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),b="spectrum.id";t.fn.spectrum=function(e,n){if(typeof e=="string")return e=="get"?i[this.eq(0).data(b)].get():e=="container"?i[t(this).data(b)].container:this.each(function(){var r=i[t(this).data(b)];r&&(e=="show"&&r.show(),e=="hide"&&r.hide(),e=="toggle"&&r.toggle(),e=="reflow"&&r.reflow(),e=="set"&&r.set(n),e=="destroy"&&(r.destroy(),t(this).removeData(b)))});return this.spectrum("destroy").each(function(){var n=h(this,e);t(this).data(b,n.id)})},t.fn.spectrum.load=!0,t.fn.spectrum.loadOpts={},t.fn.spectrum.draggable=g,t.fn.spectrum.defaults=r,t.fn.spectrum.processNativeColorInputs=function(){var e=t("<input type='color' value='!' />")[0],n=e.type==="color"&&e.value!="!";n||t("input[type=color]").spectrum({preferredFormat:"hex6"})},function(e){function l(e,t){if(typeof e=="object"&&e.hasOwnProperty("_tc_id"))return e;var n=c(e),i=n.r,o=n.g,u=n.b,a=f(n.a),h=n.format;return{ok:n.ok,format:h,_tc_id:r++,alpha:a,toHsv:function(){var e=v(i,o,u);return{h:e.h,s:e.s,v:e.v,a:a}},toHsvString:function(){var e=v(i,o,u),t=s(e.h*360),n=s(e.s*100),r=s(e.v*100);return a==1?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+a+")"},toHsl:function(){var e=p(i,o,u);return{h:e.h,s:e.s,l:e.l,a:a}},toHslString:function(){var e=p(i,o,u),t=s(e.h*360),n=s(e.s*100),r=s(e.l*100);return a==1?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+a+")"},toHex:function(){return g(i,o,u)},toHexString:function(e){return"#"+g(i,o,u,e)},toRgb:function(){return{r:s(i),g:s(o),b:s(u),a:a}},toRgbString:function(){return a==1?"rgb("+s(i)+", "+s(o)+", "+s(u)+")":"rgba("+s(i)+", "+s(o)+", "+s(u)+", "+a+")"},toName:function(){return b[g(i,o,u)]||!1},toFilter:function(e,t){var n=secondHex=g(i,o,u,!0),r=secondAlphaHex=Math.round(f(a)*255).toString(16),s=e&&e.gradientType?"GradientType = 1, ":"";if(t){var c=l(t);secondHex=c.toHex(),secondAlphaHex=Math.round(f(c.alpha)*255).toString(16)}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr=#"+C(r)+n+",endColorstr=#"+C(secondAlphaHex)+secondHex+")"},toString:function(e){e=e||this.format;var t=!1;return e==="rgb"&&(t=this.toRgbString()),e==="hex"&&(t=this.toHexString()),e==="hex6"&&(t=this.toHexString(!0)),e==="name"&&(t=this.toName()),e==="hsl"&&(t=this.toHslString()),e==="hsv"&&(t=this.toHsvString()),t||this.toHexString()}}}function c(e){var t={r:0,g:0,b:0},n=1,r=!1,i=!1;typeof e=="string"&&(e=L(e));if(typeof e=="object"){if(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b"))t=h(e.r,e.g,e.b),r=!0,i="rgb";else if(e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v"))t=m(e.h,e.s,e.v),r=!0,i="hsv";else if(e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")){var t=d(e.h,e.s,e.l);r=!0,i="hsl"}e.hasOwnProperty("a")&&(n=e.a)}return t.r=o(255,u(t.r,0)),t.g=o(255,u(t.g,0)),t.b=o(255,u(t.b,0)),t.r<1&&(t.r=s(t.r)),t.g<1&&(t.g=s(t.g)),t.b<1&&(t.b=s(t.b)),{ok:r,format:e&&e.format||i,r:t.r,g:t.g,b:t.b,a:n}}function h(e,t,n){return{r:E(e,255)*255,g:E(t,255)*255,b:E(n,255)*255}}function p(e,t,n){e=E(e,255),t=E(t,255),n=E(n,255);var r=u(e,t,n),i=o(e,t,n),s,a,f=(r+i)/2;if(r==i)s=a=0;else{var l=r-i;a=f>.5?l/(2-r-i):l/(r+i);switch(r){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return{h:s,s:a,l:f}}function d(e,t,n){function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var r,i,s;e=E(e,360),t=E(t,100),n=E(n,100);if(t==0)r=i=s=n;else{var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return{r:r*255,g:i*255,b:s*255}}function v(e,t,n){e=E(e,255),t=E(t,255),n=E(n,255);var r=u(e,t,n),i=o(e,t,n),s,a,f=r,l=r-i;a=r==0?0:l/r;if(r==i)s=0;else{switch(r){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return{h:s,s:a,v:f}}function m(e,t,n){var r,s,o;e=E(e,360)*6,t=E(t,100),n=E(n,100);var u=i.floor(e),a=e-u,f=n*(1-t),l=n*(1-a*t),c=n*(1-(1-a)*t),h=u%6,r=[n,l,f,f,c,n][h],s=[c,n,n,l,f,f][h],o=[f,f,c,n,n,l][h];return{r:r*255,g:s*255,b:o*255}}function g(e,t,n,r){var i=[C(s(e).toString(16)),C(s(t).toString(16)),C(s(n).toString(16))];return!r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function w(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function E(e,t){T(e)&&(e="100%");var n=N(e);return e=o(t,u(0,f(e))),n&&(e*=t/100),i.abs(e-t)<1e-6?1:e>=1?e%t/f(t):e}function S(e){return o(1,u(0,e))}function x(e){return parseInt(e,16)}function T(e){return typeof e=="string"&&e.indexOf(".")!=-1&&f(e)===1}function N(e){return typeof e=="string"&&e.indexOf("%")!=-1}function C(e){return e.length==1?"0"+e:""+e}function L(e){e=e.replace(t,"").replace(n,"").toLowerCase();var r=!1;if(y[e])e=y[e],r=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0};var i;return(i=k.rgb.exec(e))?{r:i[1],g:i[2],b:i[3]}:(i=k.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=k.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=k.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=k.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=k.hex6.exec(e))?{r:x(i[1]),g:x(i[2]),b:x(i[3]),format:r?"name":"hex"}:(i=k.hex3.exec(e))?{r:x(i[1]+""+i[1]),g:x(i[2]+""+i[2]),b:x(i[3]+""+i[3]),format:r?"name":"hex"}:!1}var t=/^[\s,#]+/,n=/\s+$/,r=0,i=Math,s=i.round,o=i.min,u=i.max,a=i.random,f=e.parseFloat;l.fromRatio=function(e){if(typeof e=="object")for(var t in e)e[t]===1&&(e[t]="1.0");return l(e)},l.equals=function(e,t){return!e||!t?!1:l(e).toRgbString()==l(t).toRgbString()},l.random=function(){return l.fromRatio({r:a(),g:a(),b:a()})},l.desaturate=function(e,t){var n=l(e).toHsl();return n.s-=(t||10)/100,n.s=S(n.s),l(n)},l.saturate=function(e,t){var n=l(e).toHsl();return n.s+=(t||10)/100,n.s=S(n.s),l(n)},l.greyscale=function(e){return l.desaturate(e,100)},l.lighten=function(e,t){var n=l(e).toHsl();return n.l+=(t||10)/100,n.l=S(n.l),l(n)},l.darken=function(e,t){var n=l(e).toHsl();return n.l-=(t||10)/100,n.l=S(n.l),l(n)},l.complement=function(e){var t=l(e).toHsl();return t.h=(t.h+.5)%1,l(t)},l.triad=function(e){var t=l(e).toHsl(),n=t.h*360;return[l(e),l({h:(n+120)%360,s:t.s,l:t.l}),l({h:(n+240)%360,s:t.s,l:t.l})]},l.tetrad=function(e){var t=l(e).toHsl(),n=t.h*360;return[l(e),l({h:(n+90)%360,s:t.s,l:t.l}),l({h:(n+180)%360,s:t.s,l:t.l}),l({h:(n+270)%360,s:t.s,l:t.l})]},l.splitcomplement=function(e){var t=l(e).toHsl(),n=t.h*360;return[l(e),l({h:(n+72)%360,s:t.s,l:t.l}),l({h:(n+216)%360,s:t.s,l:t.l})]},l.analogous=function(e,t,n){t=t||6,n=n||30;var r=l(e).toHsl(),i=360/n,s=[l(e)];r.h*=360;for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,s.push(l(r));return s},l.monochromatic=function(e,t){t=t||6;var n=l(e).toHsv(),r=n.h,i=n.s,s=n.v,o=[],u=1/t;while(t--)o.push(l({h:r,s:i,v:s})),s=(s+u)%1;return o},l.readable=function(e,t){var n=l(e).toRgb(),r=l(t).toRgb();return(r.r-n.r)*(r.r-n.r)+(r.g-n.g)*(r.g-n.g)+(r.b-n.b)*(r.b-n.b)>10404};var y=l.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},b=l.hexNames=w(y),k=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();e.tinycolor=l}(this),t(function(){t.fn.spectrum.load&&t.fn.spectrum.processNativeColorInputs()})})(this,e)}),define("colorpicker/colorpicker-plugin",["require","aloha","ui/ui","ui/button","PubSub","aloha/plugin","jquery","aptoma/lib/css","aptoma/lib/range","aptoma/lib/style","./vendor/spectrum/spectrum"],function(e){var t=e("aloha"),n=e("ui/ui"),r=e("ui/button"),i=e("PubSub"),s=e("aloha/plugin"),o=e("jquery"),u=e("aptoma/lib/css"),a=e("aptoma/lib/range"),f=e("aptoma/lib/style");return e("./vendor/spectrum/spectrum"),s.create("colorpicker",{tmpClassName:"tmp-colorpicker-color",colorpickers:{},tooltips:{foregroundColor:"Change foreground color",backgroundColor:"Change background color"},typeStyle:{foregroundColor:"color",backgroundColor:"backgroundColor"},init:function(){this.cssClassApplier=u.createClassApplier(this.tmpClassName),this.createButtons(),this.subscribeEvents()},createButtons:function(){var e=this;o.each(["backgroundColor","foregroundColor"],function(t,i){var s={style:e.typeStyle[i],button:n.adopt(i,r,{tooltip:e.tooltips[i],icon:"cp-plugin-icon cp-plugin-icon-"+i})};s.el=s.button.element,s.button.element.append(o('<div class="cp-plugin-color-preview"/>')),e.colorpickers[i]=s;var u=o.extend({show:function(t){e.onShow(t,s)},change:function(t){e.onChangeColor(t,s)},move:function(t){e.updateColorOnSelection(t,s)},hide:function(t){e.onHide(t,s)}},e.settings);s.el.spectrum(u),e.updateColorPreview(s.el.spectrum("get"),s)})},subscribeEvents:function(){var e=this;i.sub("aloha.selection.context-change",function(n){t.activeEditable&&e.onSelectionChanged(n.range)})},onSelectionChanged:function(e){var n=this;o.each(this.typeStyle,function(r,i){var s=e.findMarkup(function(){return f.hasStyle(this,i)},t.activeEditable.obj);s||(s=e.getCommonAncestorContainer()),n.colorpickers[r].el.spectrum("set",f.getComputedStyle(s,i)),n.updateColorPreview(n.colorpickers[r].el.spectrum("get"),n.colorpickers[r])})},onChangeColor:function(e,t){t.selectedColor=e,this.updateColorOnSelection(e,t)},onHide:function(e,t){this.updateColorOnSelection(t.selectedColor,t),t.button.element.removeClass("aloha-button-active")},updateColorOnSelection:function(e,n){var r=t.Selection.getRangeObject();r.isCollapsed()?this.cssClassApplier.applyToRange(a.createExpandedRangeFromCollapsed(r)):this.cssClassApplier.applyToSelection(),e.alpha===0&&n.style==="background-color"?o("."+this.tmpClassName).css(n.style,"").removeClass(this.tmpClassName):o("."+this.tmpClassName).css(n.style,e.toRgbString()).removeClass(this.tmpClassName),this.updateColorPreview(e,n)},updateColorPreview:function(e,t){o(".cp-plugin-color-preview",t.button.element).css("background-color",e.toRgbString())},onShow:function(e,t){t.selectedColor=e,t.button.element.addClass("aloha-button-active"),t.el.spectrum("container").unbind("click.colorpicker mousedown.colorpicker").bind("click.colorpicker mousedown.colorpicker",function(e){e.stopPropagation()}).position({my:"left bottom",at:"left top",of:t.el})}})}),define("aptoma/lib/ui/menuButton",["jquery","ui/component","ui/utils","jqueryui"],function(e,t,n){function i(t,r){var o=[];return e.each(r,function(r,u){var a=e("<li>");a.append(e("<a>",{href:"javascript:void 0",html:n.makeButtonLabelWithIcon(u)})),u["class"]&&a.addClass(u["class"]),u.click&&a.data("aloha-ui-menubutton-select",function(){u.click()!==!1&&t()});if(u.menu){var f=e("<ul>").appendTo(a);f.append(i(s(f,t),u.menu))}o.push(a[0])}),o}function s(t,n){return n=n||e.noop,function(){t.blur().hide(),t.parent().removeClass("aloha-ui-menubutton-pressed"),n()}}function o(e,t){var n=t.item.data("aloha-ui-menubutton-select");n&&n(e,t),e.preventDefault()}var r=t.extend({init:function(){this.element=r.makeMenuButton(this)}});return r.makeMenuButton=function(t){function c(e){e.hide().parent().removeClass("aloha-ui-menubutton-pressed")}var r=e("<div>",{"class":"aloha-ui-menubutton-container"}),u=n.makeButtonElement({"class":"aloha-ui-menubutton-expand"}),a=e("<ul>",{"class":"aloha-ui-menubutton-menu"}),f=null,l=null;return e.browser.msie&&r.addClass("aloha-ui-menubutton-iehack"),t.click?(f=n.makeButton(n.makeButtonElement({"class":"aloha-ui-menubutton-action"}),t).click(t.click),n.makeButton(u,{},!0),l=e("<div>").buttonset().append(f).append(u)):n.makeButton(u,t,!0).addClass("aloha-ui-menubutton-single").tooltip({tooltipClass:"aloha aloha-ui-tooltip",position:{my:"left top",at:"right bottom"}}),t.menu?(u.click(function(){r.addClass("aloha-ui-menubutton-pressed"),t.siblingContainer&&t.siblingContainer.find(".aloha-ui-menubutton-menu").each(function(){this!==a[0]&&c(e(this))});if(a.is(":visible")){c(a);return}return t.onShow&&t.onShow(),a.show().position({my:"left top",at:"left bottom",of:f||u}),e(document).bind("click",function(t){e(this).unbind(t),a.hide(),r.removeClass("aloha-ui-menubutton-pressed")}),!1}),r.append(l||u).append(a),a.append(i(s(a),t.menu)),a.hide().menu({select:o}),r):r.append(f)},r}),define("aptoma/lib/dom",["require","aloha","jquery"],function(e){var t=e("aloha"),n=e("jquery");return{elementCleanup:function(e){var r=!1,i=t.Selection.getRangeObject();return i.getCommonAncestorContainer()?(n.each(t.Selection.getSelectionTree(i),function(t,n){var s=n.domobj;n.selection==="full"&&(s.nodeType===3&&s.parentNode&&(s=s.parentNode),e(s),s.nodeName.toLowerCase()==="span"&&!s.attributes.length&&(GENTICS.Utils.Dom.removeFromDOM(s,i,!0),i.select(),r=!0))}),r):!1},recursiveElementCleanup:function(e,t){t=t||0,this.elementCleanup(e)&&t<10&&(this.recursiveElementCleanup(e,t),t++)}}}),define("aptoma/lib/selection",["require","aloha"],function(e){var t=e("aloha");return{selectTextFromRange:function(e){var n=t.getSelection();n.removeAllRanges(),n.addRange(e)}}}),define("font/font-plugin",["require","aloha","ui/ui","aptoma/lib/ui/menuButton","PubSub","aloha/plugin","aptoma/lib/range","aptoma/lib/css","aptoma/lib/dom","aptoma/lib/style","aptoma/lib/selection","jquery"],function(e){var t=e("aloha"),n=e("ui/ui"),r=e("aptoma/lib/ui/menuButton"),i=e("PubSub"),s=e("aloha/plugin"),o=e("aptoma/lib/range"),u=e("aptoma/lib/css"),a=e("aptoma/lib/dom"),f=e("aptoma/lib/style"),l=e("aptoma/lib/selection"),c=e("jquery");return s.create("font",{cssClassAppliers:{},defaults:{classes:[]},init:function(){var e=this,s=[];this.settings=c.extend(!0,this.defaults,this.settings),c.each(this.settings.classes,function(n,r){e.cssClassAppliers[r]=u.createClassApplier(r),s.push({"class":r,text:typeof n=="string"?n:"{font-family}",iconUrl:t.getPluginUrl("font")+"/img/tick.png",click:function(){e.toggleClassName(r),e.updateButtonTitle()}})}),this.menuButton=n.adopt("font",r,{text:"Font",menu:s,onShow:c.proxy(this.onMenuShow,this)}),c(this.menuButton.element).addClass("aloha-plugin-font").attr("title","Toggle font"),i.sub("aloha.selection.context-change",function(t){e.onSelectionChanged(t.range)})},onSelectionChanged:function(){this.updateButtonTitle()},updateButtonTitle:function(){c(".ui-button-text",this.menuButton.element).text(this.getTitleFromActiveFont())},onMenuShow:function(){this.updateMenuItems()},getTitleFromActiveFont:function(){var e="Font",n=t.Selection.getRangeObject(),r=n.getCommonAncestorContainer();if(c.isArray(this.settings.classes)){var i=f.getComputedStyle(r,"font-family");i&&(e=i)}else{var s=f.getClassNames(r);c.each(this.settings.classes,function(t,n){if(s.indexOf(n)>=0){e=t;return}})}return e},updateMenuItems:function(){var e=this.getTitleFromActiveFont();c(".ui-menu-item",this.menuButton.element).each(function(t,n){var r=c("a",n);r.text()==="{font-family}"&&(r.contents().last()[0].textContent=f.getComputedStyle(n,"font-family")),c(".aloha-ui-inline-icon",this).css("visibility",r.text()===e?"visible":"hidden")})},toggleClassName:function(e){var n=this,r=t.Selection.getRangeObject(),i;r.isCollapsed()?(i=o.createExpandedRangeFromCollapsed(r),l.selectTextFromRange(i)):i=o.rangeObjectToRangyRange(r),a.elementCleanup(function(t){c.each(f.getClassNames(t),function(r,i){e!==i&&n.settings.classes.indexOf(i)>=0&&c(t).removeClass(i)})}),this.cssClassAppliers[e].toggleRange(i)}})}),define("htmlsource/htmlbeautifier",[],function(){function e(e,t){function a(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(e,t){for(var n=0;n<t.length;n++)if(e===t[n])return!0;return!1}},this.get_content=function(){var e="",t=[],n=!1;while(this.input.charAt(this.pos)!=="<"){if(this.pos>=this.input.length)return t.length?t.join(""):["","TK_EOF"];e=this.input.charAt(this.pos),this.pos++,this.line_char_count++;if(this.Utils.in_array(e,this.Utils.whitespace)){t.length&&(n=!0),this.line_char_count--;continue}if(n){if(this.line_char_count>=this.max_char){t.push("\n");for(var r=0;r<this.indent_level;r++)t.push(this.indent_string);this.line_char_count=0}else t.push(" "),this.line_char_count++;n=!1}t.push(e)}return t.length?t.join(""):""},this.get_contents_to=function(e){if(this.pos==this.input.length)return["","TK_EOF"];var t="",n="",r=new RegExp("</"+e+"\\s*>","igm");r.lastIndex=this.pos;var i=r.exec(this.input),s=i?i.index:this.input.length;return this.pos<s&&(n=this.input.substring(this.pos,s),this.pos=s),n},this.record_tag=function(e){this.tags[e+"count"]?(this.tags[e+"count"]++,this.tags[e+this.tags[e+"count"]]=this.indent_level):(this.tags[e+"count"]=1,this.tags[e+this.tags[e+"count"]]=this.indent_level),this.tags[e+this.tags[e+"count"]+"parent"]=this.tags.parent,this.tags.parent=e+this.tags[e+"count"]},this.retrieve_tag=function(e){if(this.tags[e+"count"]){var t=this.tags.parent;while(t){if(e+this.tags[e+"count"]===t)break;t=this.tags[t+"parent"]}t&&(this.indent_level=this.tags[e+this.tags[e+"count"]],this.tags.parent=this.tags[t+"parent"]),delete this.tags[e+this.tags[e+"count"]+"parent"],delete this.tags[e+this.tags[e+"count"]],this.tags[e+"count"]==1?delete this.tags[e+"count"]:this.tags[e+"count"]--}},this.get_tag=function(){var e="",t=[],n=!1,r,i;do{if(this.pos>=this.input.length)return t.length?t.join(""):["","TK_EOF"];e=this.input.charAt(this.pos),this.pos++,this.line_char_count++;if(this.Utils.in_array(e,this.Utils.whitespace)){n=!0,this.line_char_count--;continue}if(e==="'"||e==='"')if(!t[1]||t[1]!=="!")e+=this.get_unformatted(e),n=!0;e==="="&&(n=!1),t.length&&t[t.length-1]!=="="&&e!==">"&&n&&(this.line_char_count>=this.max_char?(this.print_newline(!1,t),this.line_char_count=0):(t.push(" "),this.line_char_count++),n=!1),e==="<"&&(r=this.pos-1),t.push(e)}while(e!==">");var s=t.join(""),o;s.indexOf(" ")!=-1?o=s.indexOf(" "):o=s.indexOf(">");var a=s.substring(1,o).toLowerCase();if(s.charAt(s.length-2)==="/"||this.Utils.in_array(a,this.Utils.single_token))this.tag_type="SINGLE";else if(a==="script")this.record_tag(a),this.tag_type="SCRIPT";else if(a==="style")this.record_tag(a),this.tag_type="STYLE";else if(this.Utils.in_array(a,u)){var f=this.get_unformatted("</"+a+">",s);t.push(f),r>0&&this.Utils.in_array(this.input.charAt(r-1),this.Utils.whitespace)&&t.splice(0,0,this.input.charAt(r-1)),i=this.pos-1,this.Utils.in_array(this.input.charAt(i+1),this.Utils.whitespace)&&t.push(this.input.charAt(i+1)),this.tag_type="SINGLE"}else if(a.charAt(0)==="!")if(a.indexOf("[if")!=-1){if(s.indexOf("!IE")!=-1){var f=this.get_unformatted("-->",s);t.push(f)}this.tag_type="START"}else if(a.indexOf("[endif")!=-1)this.tag_type="END",this.unindent();else if(a.indexOf("[cdata[")!=-1){var f=this.get_unformatted("]]>",s);t.push(f),this.tag_type="SINGLE"}else{var f=this.get_unformatted("-->",s);t.push(f),this.tag_type="SINGLE"}else a.charAt(0)==="/"?(this.retrieve_tag(a.substring(1)),this.tag_type="END"):(this.record_tag(a),this.tag_type="START"),this.Utils.in_array(a,this.Utils.extra_liners)&&this.print_newline(!0,this.output);return t.join("")},this.get_unformatted=function(e,t){if(t&&t.toLowerCase().indexOf(e)!=-1)return"";var n="",r="",i=!0;do{if(this.pos>=this.input.length)return r;n=this.input.charAt(this.pos),this.pos++;if(this.Utils.in_array(n,this.Utils.whitespace)){if(!i){this.line_char_count--;continue}if(n==="\n"||n==="\r"){r+="\n",this.line_char_count=0;continue}}r+=n,this.line_char_count++,i=!0}while(r.toLowerCase().indexOf(e)==-1);return r},this.get_token=function(){var e;if(this.last_token==="TK_TAG_SCRIPT"||this.last_token==="TK_TAG_STYLE"){var t=this.last_token.substr(7);return e=this.get_contents_to(t),typeof e!="string"?e:[e,"TK_"+t]}if(this.current_mode==="CONTENT")return e=this.get_content(),typeof e!="string"?e:[e,"TK_CONTENT"];if(this.current_mode==="TAG"){e=this.get_tag();if(typeof e!="string")return e;var n="TK_TAG_"+this.tag_type;return[e,n]}},this.get_full_indent=function(e){return e=this.indent_level+e||0,e<1?"":Array(e+1).join(this.indent_string)},this.printer=function(e,t,n,r,i){this.input=e||"",this.output=[],this.indent_character=t,this.indent_string="",this.indent_size=n,this.brace_style=i,this.indent_level=0,this.max_char=r,this.line_char_count=0;for(var s=0;s<this.indent_size;s++)this.indent_string+=this.indent_character;this.print_newline=function(e,t){this.line_char_count=0;if(!t||!t.length)return;if(!e)while(this.Utils.in_array(t[t.length-1],this.Utils.whitespace))t.pop();t.push("\n");for(var n=0;n<this.indent_level;n++)t.push(this.indent_string)},this.print_token=function(e){this.output.push(e)},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var n,r,i,s,o,u;t=t||{},r=t.indent_size||4,i=t.indent_char||" ",o=t.brace_style||"collapse",s=t.max_char==0?Infinity:t.max_char||70,u=t.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],n=new a,n.printer(e,i,r,s,o);for(;;){var f=n.get_token();n.token_text=f[0],n.token_type=f[1];if(n.token_type==="TK_EOF")break;switch(n.token_type){case"TK_TAG_START":n.print_newline(!1,n.output),n.print_token(n.token_text),n.indent(),n.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":n.print_newline(!1,n.output),n.print_token(n.token_text),n.current_mode="CONTENT";break;case"TK_TAG_END":if(n.last_token==="TK_CONTENT"&&n.last_text===""){var l=n.token_text.match(/\w+/)[0],c=n.output[n.output.length-1].match(/<\s*(\w+)/);(c===null||c[1]!==l)&&n.print_newline(!0,n.output)}n.print_token(n.token_text),n.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var h=n.token_text.match(/^\s*<([a-z]+)/i);(!h||!n.Utils.in_array(h[1],u))&&n.print_newline(!1,n.output),n.print_token(n.token_text),n.current_mode="CONTENT";break;case"TK_CONTENT":n.token_text!==""&&n.print_token(n.token_text),n.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(n.token_text!==""){n.output.push("\n");var p=n.token_text;if(n.token_type=="TK_SCRIPT")var d=typeof js_beautify=="function"&&js_beautify;else if(n.token_type=="TK_STYLE")var d=typeof css_beautify=="function"&&css_beautify;if(t.indent_scripts=="keep")var v=0;else if(t.indent_scripts=="separate")var v=-n.indent_level;else var v=1;var m=n.get_full_indent(v);if(d)p=d(p.replace(/^\s*/,m),t);else{var g=p.match(/^\s*/)[0],y=g.match(/[^\n\r]*$/)[0].split(n.indent_string).length-1,b=n.get_full_indent(v-y);p=p.replace(/^\s*/,m).replace(/\r\n|\r|\n/g,"\n"+b).replace(/\s*$/,"")}p&&(n.print_token(p),n.print_newline(!0,n.output))}n.current_mode="TAG"}n.last_token=n.token_type,n.last_text=n.token_text}return n.output.join("")}return e}),define("htmlsource/codemirror",[],function(){var e;return e=function(){function e(o,u){function f(e){if(tr.onDragEvent&&tr.onDragEvent(ni,C(e)))return;A(e)}function l(e){return e>=0&&e<Tr.size}function v(e){return w(Tr,e)}function m(e,t){qr=!0;var n=t-e.height;for(var r=e;r;r=r.parent)r.height+=n}function N(e,t){return e.styles||e.highlight(xr,e.stateAfter=Jn(E(e)),tr.tabSize),e.getContent(tr.tabSize,t,tr.lineWrapping)}function L(e){var t={line:0,ch:0};Ot(t,{line:Tr.size-1,ch:v(Tr.size-1).text.length},xt(e),t,t),Hr=!0}function H(e){var t=[];return Tr.iter(0,Tr.size,function(e){t.push(e.text)}),t.join(e||"\n")}function $(e){ur.scrollTop!=Mr&&(Mr=yr.scrollTop=ur.scrollTop,Zt([]))}function Z(e){tr.fixedGutter&&vr.style.left!=yr.scrollLeft+"px"&&(vr.style.left=yr.scrollLeft+"px"),yr.scrollTop!=Mr&&(Mr=yr.scrollTop,ur.scrollTop!=Mr&&(ur.scrollTop=Mr),Zt([])),tr.onScroll&&tr.onScroll(ni)}function et(e){function t(t){ct&&(yr.draggable=!1),_r=!1,h(),p(),Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)<10&&(k(t),fn(o.line,o.ch,!0),$t())}function n(e){if(a=="single")on(o,e);else if(a=="double"){var t=mn(e);U(e,d)?on(t.from,v):on(d,t.to)}else a=="triple"&&(U(e,d)?on(v,cn({line:e.line,ch:0})):on(d,cn({line:e.line+1,ch:0})))}function r(e){var t=zn(e,!0);if(t&&!R(t,l)){Cr||Lt(),l=t,n(t),Hr=!1;var i=Yt();if(t.line>=i.to||t.line<i.from)c=setTimeout(Zn(function(){r(e)}),150)}}function i(e){clearTimeout(c);var t=zn(e);t&&n(t),k(e),$t(),Hr=!0,m(),h()}sn(_(e,"shiftKey"));for(var s=O(e);s!=br;s=s.parentNode)if(s.parentNode==gr&&s!=mr)return;for(var s=O(e);s!=br;s=s.parentNode)if(s.parentNode==dr)return tr.onGutterClick&&tr.onGutterClick(ni,K(dr.childNodes,s)+zr,e),k(e);var o=zn(e);switch(M(e)){case 3:ot&&Wn(e);return;case 2:o&&fn(o.line,o.ch,!0),setTimeout($t,20),k(e);return}if(!o){O(e)==yr&&k(e);return}Cr||Lt();var u=+(new Date),a="single";if(Or&&Or.time>u-400&&R(Or.pos,o))a="triple",k(e),setTimeout($t,20),gn(o.line);else if(Ar&&Ar.time>u-400&&R(Ar.pos,o)){a="double",Or={time:u,pos:o},k(e);var f=mn(o);on(f.from,f.to)}else Ar={time:u,pos:o};var l=o,c;if(tr.dragDrop&&bt&&!tr.readOnly&&!R(kr.from,kr.to)&&!U(o,kr.from)&&!U(kr.to,o)&&a=="single"){ct&&(yr.draggable=!0);var h=D(document,"mouseup",Zn(t),!0),p=D(yr,"drop",Zn(t),!0);_r=!0,yr.dragDrop&&yr.dragDrop();return}k(e),a=="single"&&fn(o.line,o.ch,!0);var d=kr.from,v=kr.to,m=D(document,"mousemove",Zn(function(e){clearTimeout(c),k(e),!ut&&!M(e)?i(e):r(e)}),!0),h=D(document,"mouseup",Zn(i),!0)}function tt(e){for(var t=O(e);t!=br;t=t.parentNode)if(t.parentNode==dr)return k(e);k(e)}function rt(e){if(tr.onDragEvent&&tr.onDragEvent(ni,C(e)))return;k(e);var t=zn(e,!0),n=e.dataTransfer.files;if(!t||tr.readOnly)return;if(n&&n.length&&window.FileReader&&window.File){var r=n.length,i=Array(r),s=0,o=function(e,n){var o=new FileReader;o.onload=function(){i[n]=o.result,++s==r&&(t=cn(t),Zn(function(){var e=Ft(i.join(""),t,t);on(t,e)})())},o.readAsText(e)};for(var u=0;u<r;++u)o(n[u],u)}else{if(_r&&!U(t,kr.from)&&!U(kr.to,t))return;try{var i=e.dataTransfer.getData("Text");i&&er(function(){var e=kr.from,n=kr.to;on(t,t),_r&&Ft("",e,n),It(i),$t()})}catch(e){}}}function ht(e){var t=Ut();e.dataTransfer.setData("Text",t),e.dataTransfer.setDragImage&&e.dataTransfer.setDragImage(W("img"),0,0)}function dt(e,t){if(typeof e=="string"){e=it[e];if(!e)return!1}var n=Lr;try{tr.readOnly&&(Pr=!0),t&&(Lr=null),e(ni)}catch(r){if(r!=yt)throw r;return!1}finally{Lr=n,Pr=!1}return!0}function gt(e){function i(){l=!0}var s=t(tr.keyMap),o=s.auto;clearTimeout(ri),o&&!r(e)&&(ri=setTimeout(function(){t(tr.keyMap)==s&&(tr.keyMap=o.call?o.call(null,ni):o)},50));var u=Nt[_(e,"keyCode")],a=!1,f=pt&&Y;if(u==null||e.altGraphKey)return!1;_(e,"altKey")&&(u="Alt-"+u),_(e,f?"metaKey":"ctrlKey")&&(u="Ctrl-"+u),_(e,f?"ctrlKey":"metaKey")&&(u="Cmd-"+u);var l=!1;return _(e,"shiftKey")?a=n("Shift-"+u,tr.extraKeys,tr.keyMap,function(e){return dt(e,!0)},i)||n(u,tr.extraKeys,tr.keyMap,function(e){if(typeof e=="string"&&/^go[A-Z]/.test(e))return dt(e)},i):a=n(u,tr.extraKeys,tr.keyMap,dt,i),l&&(a=!1),a&&(k(e),Xn(),ut&&(e.oldKeyCode=e.keyCode,e.keyCode=0)),a}function wt(e,t){var r=n("'"+t+"'",tr.extraKeys,tr.keyMap,function(e){return dt(e,!0)});return r&&(k(e),Xn()),r}function St(e){Cr||Lt(),ut&&e.keyCode==27&&(e.returnValue=!1),Qr&&Xt()&&(Qr=!1);if(tr.onKeyEvent&&tr.onKeyEvent(ni,C(e)))return;var t=_(e,"keyCode");sn(t==16||_(e,"shiftKey"));var n=gt(e);pt&&(ii=n?t:null,!n&&t==88&&_(e,Y?"metaKey":"ctrlKey")&&It(""))}function Ct(e){Qr&&Xt();if(tr.onKeyEvent&&tr.onKeyEvent(ni,C(e)))return;var t=_(e,"keyCode"),n=_(e,"charCode");if(pt&&t==ii){ii=null,k(e);return}if((pt&&(!e.which||e.which<10)||vt)&&gt(e))return;var r=String.fromCharCode(n==null?t:n);tr.electricChars&&xr.electricChars&&tr.smartIndent&&!tr.readOnly&&xr.electricChars.indexOf(r)>-1&&setTimeout(Zn(function(){bn(kr.to.line,"smart")}),75);if(wt(e,r))return;Wt()}function kt(e){if(tr.onKeyEvent&&tr.onKeyEvent(ni,C(e)))return;_(e,"keyCode")==16&&(Lr=null)}function Lt(){if(tr.readOnly=="nocursor")return;Cr||(tr.onFocus&&tr.onFocus(ni),Cr=!0,yr.className.search(/\bCodeMirror-focused\b/)==-1&&(yr.className+=" CodeMirror-focused")),zt(),Xn()}function At(){Cr&&(tr.onBlur&&tr.onBlur(ni),Cr=!1,Vr&&Zn(function(){Vr&&(Vr(),Vr=null)})(),yr.className=yr.className.replace(" CodeMirror-focused","")),clearInterval(Sr),setTimeout(function(){Cr||(Lr=null)},150)}function Ot(e,t,n,r,i){if(Pr)return;var s=[];Tr.iter(e.line,t.line+1,function(e){s.push(d(e.text,e.markedSpans))});if(Yr){Yr.addChange(e.line,n.length,s);while(Yr.done.length>tr.undoDepth)Yr.done.shift()}var o=c(p(s[0]),p(I(s)),e.ch,t.ch,n);Pt(e,t,o,r,i)}function Mt(e,t){if(!e.length)return;var n=e.pop(),r=[];for(var i=n.length-1;i>=0;i-=1){var s=n[i],o=[],u=s.start+s.added;Tr.iter(s.start,u,function(e){o.push(d(e.text,e.markedSpans))}),r.push({start:s.start,added:s.old.length,old:o});var a={line:s.start+s.old.length-1,ch:J(h(I(o)),h(I(s.old)))};Pt({line:s.start,ch:0},{line:u-1,ch:v(u-1).text.length},s.old,a,a)}Hr=!0,t.push(r)}function _t(){Mt(Yr.done,Yr.undone)}function Dt(){Mt(Yr.undone,Yr.done)}function Pt(e,t,n,r,i){function s(e){return e<=Math.min(t.line,t.line+S)?e:e+S}if(Pr)return;var o=!1,u=$r.text.length;tr.lineWrapping||Tr.iter(e.line,t.line+1,function(e){if(!e.hidden&&e.text.length==u)return o=!0,!0});if(e.line!=t.line||n.length>1)qr=!0;var a=t.line-e.line,f=v(e.line),l=v(t.line),c=I(n);if(e.ch==0&&t.ch==0&&h(c)==""){var d=[],y=null;for(var b=0,w=n.length-1;b<w;++b)d.push(new g(h(n[b]),p(n[b])));l.update(l.text,p(c)),a&&Tr.remove(e.line,a,Rr),d.length&&Tr.insert(e.line,d)}else if(f==l)if(n.length==1)f.update(f.text.slice(0,e.ch)+h(n[0])+f.text.slice(t.ch),p(n[0]));else{for(var d=[],b=1,w=n.length-1;b<w;++b)d.push(new g(h(n[b]),p(n[b])));d.push(new g(h(c)+f.text.slice(t.ch),p(c))),f.update(f.text.slice(0,e.ch)+h(n[0]),p(n[0])),Tr.insert(e.line+1,d)}else if(n.length==1)f.update(f.text.slice(0,e.ch)+h(n[0])+l.text.slice(t.ch),p(n[0])),Tr.remove(e.line+1,a,Rr);else{var d=[];f.update(f.text.slice(0,e.ch)+h(n[0]),p(n[0])),l.update(h(c)+l.text.slice(t.ch),p(c));for(var b=1,w=n.length-1;b<w;++b)d.push(new g(h(n[b]),p(n[b])));a>1&&Tr.remove(e.line+1,a-1,Rr),Tr.insert(e.line+1,d)}if(tr.lineWrapping){var E=Math.max(5,yr.clientWidth/qn()-3);Tr.iter(e.line,e.line+n.length,function(e){if(e.hidden)return;var t=Math.ceil(e.text.length/E)||1;t!=e.height&&m(e,t)})}else Tr.iter(e.line,e.line+n.length,function(e){var t=e.text;!e.hidden&&t.length>u&&($r=e,u=t.length,Kr=!0,o=!1)}),o&&(Jr=!0);Nr=Math.min(Nr,e.line),Qn(400);var S=n.length-a-1;jr.push({from:e.line,to:t.line+1,diff:S});if(tr.onChange){for(var b=0;b<n.length;++b)typeof n[b]!="string"&&(n[b]=n[b].text);var x={from:e,to:t,text:n};if(Fr){for(var T=Fr;T.next;T=T.next);T.next=x}else Fr=x}un(cn(r),cn(i),s(kr.from.line),s(kr.to.line))}function Ht(){var e=Tr.height*In()+2*Rn();return e*.99>yr.offsetHeight?e:!1}function Bt(e){var t=Ht();ur.style.display=t?"block":"none",t?(or.style.height=gr.style.minHeight=t+"px",ur.style.height=yr.clientHeight+"px",e!=null&&(ur.scrollTop=yr.scrollTop=e,ct&&setTimeout(function(){if(ur.scrollTop!=e)return;ur.scrollTop=e+(e?-1:1),ur.scrollTop=e},0))):gr.style.minHeight="",mr.style.top=Ur*In()+"px"}function jt(){$r=v(0),Kr=!0;var e=$r.text.length;Tr.iter(1,Tr.size,function(t){var n=t.text;!t.hidden&&n.length>e&&(e=n.length,$r=t)}),Jr=!1}function Ft(e,t,n){function r(r){if(U(r,t))return r;if(!U(n,r))return i;var s=r.line+e.length-(n.line-t.line)-1,o=r.ch;return r.line==n.line&&(o+=I(e).length-(n.ch-(n.line==t.line?t.ch:0))),{line:s,ch:o}}t=cn(t),n?n=cn(n):n=t,e=xt(e);var i;return qt(e,t,n,function(e){return i=e,{from:r(kr.from),to:r(kr.to)}}),i}function It(e,t){qt(xt(e),kr.from,kr.to,function(e){return t=="end"?{from:e,to:e}:t=="start"?{from:kr.from,to:kr.from}:{from:kr.from,to:e}})}function qt(e,t,n,r){var i=e.length==1?e[0].length+t.ch:I(e).length,s=r({line:t.line+e.length-1,ch:i});Ot(t,n,e,s.from,s.to)}function Rt(e,t,n){var r=e.line,i=t.line;if(r==i)return v(r).text.slice(e.ch,t.ch);var s=[v(r).text.slice(e.ch)];return Tr.iter(r+1,i,function(e){s.push(e.text)}),s.push(v(i).text.slice(0,t.ch)),s.join(n||"\n")}function Ut(e){return Rt(kr.from,kr.to,e)}function zt(){if(Qr)return;wr.set(tr.pollInterval,function(){Xt(),Cr&&zt()})}function Wt(){function e(){var n=Xt();!n&&!t?(t=!0,wr.set(60,e)):(Qr=!1,zt())}var t=!1;Qr=!0,wr.set(20,e)}function Xt(){if(!Cr||Tt(ir)||tr.readOnly)return!1;var e=ir.value;if(e==si)return!1;pi||Gn(),Lr=null;var t=0,n=Math.min(si.length,e.length);while(t<n&&si[t]==e[t])++t;return t<si.length?kr.from={line:kr.from.line,ch:kr.from.ch-(si.length-t)}:Dr&&R(kr.from,kr.to)&&(kr.to={line:kr.to.line,ch:Math.min(v(kr.to.line).text.length,kr.to.ch+(e.length-t))}),It(e.slice(t),"end"),e.length>1e3?ir.value=si="":si=e,pi||Yn(),!0}function Vt(e){R(kr.from,kr.to)?e&&(si=ir.value=""):(si="",ir.value=Ut(),Cr&&q(ir))}function $t(){tr.readOnly!="nocursor"&&ir.focus()}function Jt(){var e=Kt();Qt(e.x,e.y,e.x,e.yBot);if(!Cr)return;var t=gr.getBoundingClientRect(),n=null;e.y+t.top<0?n=!0:e.y+t.top+In()>(window.innerHeight||document.documentElement.clientHeight)&&(n=!1);if(n!=null){var r=lr.style.display=="none";r&&(lr.style.display="",lr.style.left=e.x+"px",lr.style.top=e.y-Ur+"px"),lr.scrollIntoView(n),r&&(lr.style.display="none")}}function Kt(){var e=Bn(kr.inverted?kr.from:kr.to),t=tr.lineWrapping?Math.min(e.x,pr.offsetWidth):e.x;return{x:t,y:e.y,yBot:e.yBot}}function Qt(e,t,n,r){var i=Gt(e,t,n,r);i.scrollLeft!=null&&(yr.scrollLeft=i.scrollLeft),i.scrollTop!=null&&(ur.scrollTop=yr.scrollTop=i.scrollTop)}function Gt(e,t,n,r){var i=Un(),s=Rn();t+=s,r+=s,e+=i,n+=i;var o=yr.clientHeight,u=ur.scrollTop,a={},f=Ht()||Infinity,l=t<s+10,c=r+s>f-10;t<u?a.scrollTop=l?0:Math.max(0,t):r>u+o&&(a.scrollTop=(c?f:r)-o);var h=yr.clientWidth,p=yr.scrollLeft,d=tr.fixedGutter?vr.clientWidth:0,v=e<d+i+10;return e<p+d||v?(v&&(e=0),a.scrollLeft=Math.max(0,e-10-d)):n>h+p-3&&(a.scrollLeft=n+10-h),a}function Yt(e){var t=In(),n=(e!=null?e:ur.scrollTop)-Rn(),r=Math.max(0,Math.floor(n/t)),i=Math.ceil((n+yr.clientHeight)/t);return{from:S(Tr,r),to:S(Tr,i)}}function Zt(e,t,n){function r(){var e=ar.firstChild,t=!1;return Tr.iter(zr,Wr,function(n){if(!e)return;if(!n.hidden){var r=Math.round(e.offsetHeight/c)||1;n.height!=r&&(m(n,r),qr=t=!0)}e=e.nextSibling}),t}if(!yr.clientWidth){zr=Wr=Ur=0;return}var i=Yt(n);if(e!==!0&&e.length==0&&i.from>zr&&i.to<Wr){Bt(n);return}var s=Math.max(i.from-100,0),o=Math.min(Tr.size,i.to+100);zr<s&&s-zr<20&&(s=zr),Wr>o&&Wr-o<20&&(o=Math.min(Tr.size,Wr));var u=e===!0?[]:en([{from:zr,to:Wr,domStart:0}],e),a=0;for(var f=0;f<u.length;++f){var l=u[f];l.from<s&&(l.domStart+=s-l.from,l.from=s),l.to>o&&(l.to=o),l.from>=l.to?u.splice(f--,1):a+=l.to-l.from}if(a==o-s&&s==zr&&o==Wr){Bt(n);return}u.sort(function(e,t){return e.domStart-t.domStart});var c=In(),h=vr.style.display;ar.style.display="none",tn(s,o,u),ar.style.display=vr.style.display="";var p=s!=zr||o!=Wr||Xr!=yr.clientHeight+c;p&&(Xr=yr.clientHeight+c),(s!=zr||o!=Wr&&tr.onViewportChange)&&setTimeout(function(){tr.onViewportChange&&tr.onViewportChange(ni,s,o)}),zr=s,Wr=o,Ur=x(Tr,s),Qn(100);if(ar.childNodes.length!=Wr-zr)throw new Error("BAD PATCH! "+JSON.stringify(u)+" size="+(Wr-zr)+" nodes="+ar.childNodes.length);return tr.lineWrapping&&r(),vr.style.display=h,(p||qr)&&nn()&&tr.lineWrapping&&r()&&nn(),Bt(n),rn(),!t&&tr.onUpdate&&tr.onUpdate(ni),!0}function en(e,t){for(var n=0,r=t.length||0;n<r;++n){var i=t[n],s=[],o=i.diff||0;for(var u=0,a=e.length;u<a;++u){var f=e[u];i.to<=f.from&&i.diff?s.push({from:f.from+o,to:f.to+o,domStart:f.domStart}):i.to<=f.from||i.from>=f.to?s.push(f):(i.from>f.from&&s.push({from:f.from,to:i.from,domStart:f.domStart}),i.to<f.to&&s.push({from:i.to+o,to:f.to+o,domStart:f.domStart+(i.to-f.from)}))}e=s}return e}function tn(e,t,n){function r(e){var t=e.nextSibling;return e.parentNode.removeChild(e),t}if(!n.length)X(ar);else{var i=0,s=ar.firstChild,o;for(var u=0;u<n.length;++u){var a=n[u];while(a.domStart>i)s=r(s),i++;for(var f=0,l=a.to-a.from;f<l;++f)s=s.nextSibling,i++}while(s)s=r(s)}var c=n.shift(),s=ar.firstChild,f=e;Tr.iter(e,t,function(e){c&&c.to==f&&(c=n.shift());if(!c||c.from>f){if(e.hidden)var t=W("pre");else{var t=N(e);e.className&&(t.className=e.className);if(e.bgClassName){var r=W("pre","",e.bgClassName,"position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: -2");t=W("div",[r,t],null,"position: relative")}}ar.insertBefore(t,s)}else s=s.nextSibling;++f})}function nn(){if(!tr.gutter&&!tr.lineNumbers)return;var e=mr.offsetHeight,t=yr.clientHeight;vr.style.height=(e-t<2?t:e)+"px";var n=document.createDocumentFragment(),r=zr,i;Tr.iter(zr,Math.max(Wr,zr+1),function(e){if(e.hidden)n.appendChild(W("pre"));else{var t=e.gutterMarker,s=tr.lineNumbers?tr.lineNumberFormatter(r+tr.firstLineNumber):null;t&&t.text?s=t.text.replace("%N%",s!=null?s:""):s==null&&(s="");var o=n.appendChild(W("pre",null,t&&t.style));o.innerHTML=s;for(var u=1;u<e.height;++u)o.appendChild(W("br")),o.appendChild(document.createTextNode(""));t||(i=r)}++r}),vr.style.display="none",V(dr,n);if(i!=null&&tr.lineNumbers){var s=dr.childNodes[i-zr],o=String(Tr.size).length,u=j(s.firstChild),a="";while(u.length+a.length<o)a+="";a&&s.insertBefore(document.createTextNode(a),s.firstChild)}vr.style.display="";var f=Math.abs((parseInt(pr.style.marginLeft)||0)-vr.offsetWidth)>2;return pr.style.marginLeft=vr.offsetWidth+"px",qr=!1,f}function rn(){var e=R(kr.from,kr.to),t=Bn(kr.from,!0),n=e?t:Bn(kr.to,!0),r=kr.inverted?t:n,i=In(),s=B(br),o=B(ar);sr.style.top=Math.max(0,Math.min(yr.offsetHeight,r.y+o.top-s.top))+"px",sr.style.left=Math.max(0,Math.min(yr.offsetWidth,r.x+o.left-s.left))+"px";if(e)lr.style.top=r.y+"px",lr.style.left=(tr.lineWrapping?Math.min(r.x,pr.offsetWidth):r.x)+"px",lr.style.display="",fr.style.display="none";else{var u=t.y==n.y,a=document.createDocumentFragment(),f=pr.clientWidth||pr.offsetWidth,l=pr.clientHeight||pr.offsetHeight,c=function(e,t,n,r){var i=lt?"width: "+(n?f-n-e:f)+"px":"right: "+n+"px";a.appendChild(W("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; "+i+"; height: "+r+"px"))};if(kr.from.ch&&t.y>=0){var h=u?f-n.x:0;c(t.x,t.y,h,i)}var p=Math.max(0,t.y+(kr.from.ch?i:0)),d=Math.min(n.y,l)-p;d>.2*i&&c(0,p,0,d),(!u||!kr.from.ch)&&n.y<l-.5*i&&c(0,n.y,f-n.x,i),V(fr,a),lr.style.display="none",fr.style.display=""}}function sn(e){e?Lr=Lr||(kr.inverted?kr.to:kr.from):Lr=null}function on(e,t){var n=Lr&&cn(Lr);n&&(U(n,e)?e=n:U(t,n)&&(t=n)),un(e,t),Br=!0}function un(e,t,n,r){Gr=null,n==null&&(n=kr.from.line,r=kr.to.line);if(R(kr.from,e)&&R(kr.to,t))return;if(U(t,e)){var i=t;t=e,e=i}if(e.line!=n){var s=an(e,n,kr.from.ch);s?e=s:Dn(e.line,!1)}t.line!=r&&(t=an(t,r,kr.to.ch)),R(e,t)?kr.inverted=!1:R(e,kr.to)?kr.inverted=!1:R(t,kr.from)&&(kr.inverted=!0);if(tr.autoClearEmptyLines&&R(kr.from,kr.to)){var o=kr.inverted?e:t;if(o.line!=kr.from.line&&kr.from.line<Tr.size){var u=v(kr.from.line);/^\s+$/.test(u.text)&&setTimeout(Zn(function(){if(u.parent&&/^\s+$/.test(u.text)){var e=E(u);Ft("",{line:e,ch:0},{line:e,ch:u.text.length})}},10))}}kr.from=e,kr.to=t,Ir=!0}function an(e,t,n){function r(t){var r=e.line+t,i=t==1?Tr.size:-1;while(r!=i){var o=v(r);if(!o.hidden){var u=e.ch;if(s||u>n||u>o.text.length)u=o.text.length;return{line:r,ch:u}}r+=t}}var i=v(e.line),s=e.ch==i.text.length&&e.ch!=n;return i.hidden?e.line>=t?r(1)||r(-1):r(-1)||r(1):e}function fn(e,t,n){var r=cn({line:e,ch:t||0});(n?on:un)(r,r)}function ln(e){return Math.max(0,Math.min(e,Tr.size-1))}function cn(e){if(e.line<0)return{line:0,ch:0};if(e.line>=Tr.size)return{line:Tr.size-1,ch:v(Tr.size-1).text.length};var t=e.ch,n=v(e.line).text.length;return t==null||t>n?{line:e.line,ch:n}:t<0?{line:e.line,ch:0}:e}function hn(e,t){function n(){for(var t=s+e,n=e<0?-1:Tr.size;t!=n;t+=e){var r=v(t);if(!r.hidden)return s=t,u=r,!0}}function r(t){if(o==(e<0?0:u.text.length)){if(!!t||!n())return!1;o=e<0?u.text.length:0}else o+=e;return!0}var i=kr.inverted?kr.from:kr.to,s=i.line,o=i.ch,u=v(s);if(t=="char")r();else if(t=="column")r(!0);else if(t=="word"){var a=!1;for(;;){if(e<0&&!r())break;if(Q(u.text.charAt(o)))a=!0;else if(a){e<0&&(e=1,r());break}if(e>0&&!r())break}}return{line:s,ch:o}}function pn(e,t){var n=e<0?kr.from:kr.to;if(Lr||R(kr.from,kr.to))n=hn(e,t);fn(n.line,n.ch,!0)}function dn(e,t){R(kr.from,kr.to)?e<0?Ft("",hn(e,t),kr.to):Ft("",kr.from,hn(e,t)):Ft("",kr.from,kr.to),Br=!0}function vn(e,t){var n=0,r=Bn(kr.inverted?kr.from:kr.to,!0);Gr!=null&&(r.x=Gr);if(t=="page")var i=Math.min(yr.clientHeight,window.innerHeight||document.documentElement.clientHeight),s=jn(r.x,r.y+i*e);else if(t=="line")var o=In(),s=jn(r.x,r.y+.5*o+e*o);t=="page"&&(ur.scrollTop+=Bn(s,!0).y-r.y),fn(s.line,s.ch,!0),Gr=r.x}function mn(e){var t=v(e.line).text,n=e.ch,r=e.ch;if(t){e.after===!1||r==t.length?--n:++r;var i=t.charAt(n),s=Q(i)?Q:/\s/.test(i)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!Q(e)};while(n>0&&s(t.charAt(n-1)))--n;while(r<t.length&&s(t.charAt(r)))++r}return{from:{line:e.line,ch:n},to:{line:e.line,ch:r}}}function gn(e){on({line:e,ch:0},cn({line:e+1,ch:0}))}function yn(e){if(R(kr.from,kr.to))return bn(kr.from.line,e);var t=kr.to.line-(kr.to.ch?0:1);for(var n=kr.from.line;n<=t;++n)bn(n,e)}function bn(e,t){t||(t="add");if(t=="smart")if(!xr.indent)t="prev";else var n=Jn(e);var r=v(e),i=r.indentation(tr.tabSize),s=r.text.match(/^\s*/)[0],o;t=="smart"&&(o=xr.indent(n,r.text.slice(s.length),r.text),o==yt&&(t="prev")),t=="prev"?e?o=v(e-1).indentation(tr.tabSize):o=0:t=="add"?o=i+tr.indentUnit:t=="subtract"&&(o=i-tr.indentUnit),o=Math.max(0,o);var u=o-i,a="",f=0;if(tr.indentWithTabs)for(var l=Math.floor(o/tr.tabSize);l;--l)f+=tr.tabSize,a+="	";f<o&&(a+=F(o-f)),a!=s&&Ft(a,{line:e,ch:0},{line:e,ch:s.length})}function wn(){xr=e.getMode(tr,tr.mode),Tr.iter(0,Tr.size,function(e){e.stateAfter=null}),Nr=0,Qn(100)}function En(){var e=tr.gutter||tr.lineNumbers;vr.style.display=e?"":"none",e?qr=!0:ar.parentNode.style.marginLeft=0}function Sn(e,t){if(tr.lineWrapping){br.className+=" CodeMirror-wrap";var n=yr.clientWidth/qn()-3;Tr.iter(0,Tr.size,function(e){if(e.hidden)return;var t=Math.ceil(e.text.length/n)||1;t!=1&&m(e,t)}),pr.style.minWidth=cr.style.left=""}else br.className=br.className.replace(" CodeMirror-wrap",""),jt(),Tr.iter(0,Tr.size,function(e){e.height!=1&&!e.hidden&&m(e,1)});jr.push({from:0,to:Tr.size})}function xn(){yr.className=yr.className.replace(/\s*cm-s-\S+/g,"")+tr.theme.replace(/(^|\s)\s*/g," cm-s-")}function Tn(){var e=st[tr.keyMap].style;br.className=br.className.replace(/\s*cm-keymap-\S+/g,"")+(e?" cm-keymap-"+e:"")}function Nn(e,t){this.lines=[],this.type=e,t&&(this.style=t)}function Cn(e,t,n,r){e=cn(e),t=cn(t);var i=new Nn("range",n);if(r)for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s]);var o=e.line;return Tr.iter(o,t.line+1,function(n){var r={from:o==e.line?e.ch:null,to:o==t.line?t.ch:null,marker:i};(n.markedSpans||(n.markedSpans=[])).push(r),i.lines.push(n),++o}),jr.push({from:e.line,to:t.line+1}),i}function kn(e){e=cn(e);var t=new Nn("bookmark"),n=v(e.line),r={from:e.ch,to:e.ch,marker:t};return(n.markedSpans||(n.markedSpans=[])).push(r),t.lines.push(n),t}function Ln(e){e=cn(e);var t=[],n=v(e.line).markedSpans;if(n)for(var r=0;r<n.length;++r){var i=n[r];(i.from==null||i.from<=e.ch)&&(i.to==null||i.to>=e.ch)&&t.push(i.marker)}return t}function An(e,t,n){return typeof e=="number"&&(e=v(ln(e))),e.gutterMarker={text:t,style:n},qr=!0,e}function On(e){typeof e=="number"&&(e=v(ln(e))),e.gutterMarker=null,qr=!0}function Mn(e,t){var n=e,r=e;return typeof e=="number"?r=v(ln(e)):n=E(e),n==null?null:t(r,n)?(jr.push({from:n,to:n+1}),r):null}function _n(e,t,n){return Mn(e,function(e){if(e.className!=t||e.bgClassName!=n)return e.className=t,e.bgClassName=n,!0})}function Dn(e,t){return Mn(e,function(e,n){if(e.hidden!=t){e.hidden=t,tr.lineWrapping||(t&&e.text.length==$r.text.length?Jr=!0:!t&&e.text.length>$r.text.length&&($r=e,Jr=!1)),m(e,t?0:1);var r=kr.from.line,i=kr.to.line;if(t&&(r==n||i==n)){var s=r==n?an({line:r,ch:0},r,0):kr.from,o=i==n?an({line:i,ch:0},i,0):kr.to;if(!o)return;un(s,o)}return qr=!0}})}function Pn(e){if(typeof e=="number"){if(!l(e))return null;var t=e;e=v(e);if(!e)return null}else{var t=E(e);if(t==null)return null}var n=e.gutterMarker;return{line:t,handle:e,text:e.text,markerText:n&&n.text,markerClass:n&&n.style,lineClass:e.className,bgClass:e.bgClassName}}function Hn(e,t){if(t==0)return{top:0,left:0};var n=tr.lineWrapping&&t<e.text.length&&Et.test(e.text.slice(t-1,t+1)),r=N(e,t);V(hr,r);var i=r.anchor,s=i.offsetTop,o=i.offsetLeft;if(ut&&s==0&&o==0){var u=W("span","x");i.parentNode.insertBefore(u,i.nextSibling),s=u.offsetTop}return{top:s,left:o}}function Bn(e,t){var n,r=In(),i=r*(x(Tr,e.line)-(t?Ur:0));if(e.ch==0)n=0;else{var s=Hn(v(e.line),e.ch);n=s.left,tr.lineWrapping&&(i+=Math.max(0,s.top))}return{x:n,y:i,yBot:i+r}}function jn(e,t){function n(e){var t=Hn(u,e);if(f){var n=Math.round(t.top/r);return c=n!=l,Math.max(0,t.left+(n-l)*yr.clientWidth)}return t.left}var r=In(),i=qn(),s=Ur+Math.floor(t/r);if(s<0)return{line:0,ch:0};var o=S(Tr,s);if(o>=Tr.size)return{line:Tr.size-1,ch:v(Tr.size-1).text.length};var u=v(o),a=u.text,f=tr.lineWrapping,l=f?s-x(Tr,o):0;if(e<=0&&l==0)return{line:o,ch:0};var c=!1,h=0,p=0,d=a.length,m,g=Math.min(d,Math.ceil((e+l*yr.clientWidth*.9)/i));for(;;){var y=n(g);if(!(y<=e&&g<d)){m=y,d=g;break}g=Math.min(d,Math.ceil(g*1.2))}if(e>m)return{line:o,ch:d};g=Math.floor(d*.8),y=n(g),y<e&&(h=g,p=y);for(;;){if(d-h<=1){var b=e-p<m-e;return{line:o,ch:b?h:d,after:b}}var w=Math.ceil((h+d)/2),E=n(w);E>e?(d=w,m=E,c&&(m+=1e3)):(h=w,p=E)}}function Fn(e){var t=Bn(e,!0),n=B(pr);return{x:n.left+t.x,y:n.top+t.y,yBot:n.top+t.yBot}}function In(){if(ai==null){ai=W("pre");for(var e=0;e<49;++e)ai.appendChild(document.createTextNode("x")),ai.appendChild(W("br"));ai.appendChild(document.createTextNode("x"))}var t=ar.clientHeight;return t==ui?oi:(ui=t,V(hr,ai.cloneNode(!0)),oi=hr.firstChild.offsetHeight/50||1,X(hr),oi)}function qn(){if(yr.clientWidth==li)return fi;li=yr.clientWidth;var e=W("span","x"),t=W("pre",[e]);return V(hr,t),fi=e.offsetWidth||10}function Rn(){return pr.offsetTop}function Un(){return pr.offsetLeft}function zn(e,t){var n=B(yr,!0),r,i;try{r=e.clientX,i=e.clientY}catch(e){return null}if(!t&&(r-n.left>yr.clientWidth||i-n.top>yr.clientHeight))return null;var s=B(pr,!0);return jn(r-s.left,i-s.top)}function Wn(e){function t(){sr.style.position="relative",ir.style.cssText=i,ft&&(ur.scrollTop=r),zt();if(ir.selectionStart!=null){clearTimeout(ci);var e=ir.value=" "+(R(kr.from,kr.to)?"":ir.value),t=0;si=" ",ir.selectionStart=1,ir.selectionEnd=e.length,ci=setTimeout(function n(){si==" "&&ir.selectionStart==0?Zn(it.selectAll)(ni):t++<10?ci=setTimeout(n,500):Vt()},200)}}var n=zn(e),r=ur.scrollTop;if(!n||pt)return;(R(kr.from,kr.to)||U(n,kr.from)||!U(n,kr.to))&&Zn(fn)(n.line,n.ch);var i=ir.style.cssText;sr.style.position="absolute",ir.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; "+"border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",$t(),Vt(!0),R(kr.from,kr.to)&&(ir.value=si=" ");if(ot){A(e);var s=D(window,"mouseup",function(){s(),setTimeout(t,20)},!0)}else setTimeout(t,50)}function Xn(){clearInterval(Sr);var e=!0;lr.style.visibility="",Sr=setInterval(function(){lr.style.visibility=(e=!e)?"":"hidden"},tr.cursorBlinkRate)}function Vn(e){function t(e,t,n){if(!e.text)return;var r=e.styles,i=u?0:e.text.length-1,s;for(var o=u?0:r.length-2,f=u?r.length:-2;o!=f;o+=2*a){var l=r[o];if(r[o+1]!=p){i+=a*l.length;continue}for(var c=u?0:l.length-1,h=u?l.length:-1;c!=h;c+=a,i+=a)if(i>=t&&i<n&&m.test(s=l.charAt(c))){var v=hi[s];if(v.charAt(1)==">"==u)d.push(s);else{if(d.pop()!=v.charAt(0))return{pos:i,match:!1};if(!d.length)return{pos:i,match:!0}}}}}var n=kr.inverted?kr.from:kr.to,r=v(n.line),i=n.ch-1,s=i>=0&&hi[r.text.charAt(i)]||hi[r.text.charAt(++i)];if(!s)return;var o=s.charAt(0),u=s.charAt(1)==">",a=u?1:-1,f=r.styles;for(var l=i+1,c=0,h=f.length;c<h;c+=2)if((l-=f[c].length)<=0){var p=f[c+1];break}var d=[r.text.charAt(i)],m=/[(){}[\]]/;for(var c=n.line,h=u?Math.min(c+100,Tr.size):Math.max(-1,c-100);c!=h;c+=a){var r=v(c),g=c==n.line,y=t(r,g&&u?i+1:0,g&&!u?i:r.text.length);if(y)break}y||(y={pos:null,match:!1});var p=y.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",b=Cn({line:n.line,ch:i},{line:n.line,ch:i+1},p),w=y.pos!=null&&Cn({line:c,ch:y.pos},{line:c,ch:y.pos+1},p),E=Zn(function(){b.clear(),w&&w.clear()});e?setTimeout(E,800):Vr=E}function $n(e){var t,n;for(var r=e,i=e-40;r>i;--r){if(r==0)return 0;var s=v(r-1);if(s.stateAfter)return r;var o=s.indentation(tr.tabSize);if(n==null||t>o)n=r-1,t=o}return n}function Jn(e){var t=$n(e),n=t&&v(t-1).stateAfter;return n?n=i(xr,n):n=s(xr),Tr.iter(t,e,function(r){r.process(xr,n,tr.tabSize),r.stateAfter=t==e-1||t%5==0?i(xr,n):null}),n}function Kn(){if(Nr>=Wr)return;var e=+(new Date)+tr.workTime,t=i(xr,Jn(Nr)),n=Nr;Tr.iter(Nr,Wr,function(n){Nr>=zr?(n.highlight(xr,t,tr.tabSize),n.stateAfter=i(xr,t)):(n.process(xr,t,tr.tabSize),n.stateAfter=Nr%5==0?i(xr,t):null),++Nr;if(+(new Date)>e)return Qn(tr.workDelay),!0}),Wr>n&&Nr>=zr&&Zn(function(){jr.push({from:n,to:Nr})})()}function Qn(e){Nr<Wr&&Er.set(e,Kn)}function Gn(){Hr=Br=Fr=null,jr=[],Ir=!1,Rr=[]}function Yn(){Jr&&jt();if(Kr&&!tr.lineWrapping){var e=cr.offsetWidth,t=Hn($r,$r.text.length).left;at||(cr.style.left=t+"px",pr.style.minWidth=t+e+"px"),Kr=!1}var n,r;if(Ir){var i=Kt();n=Gt(i.x,i.y,i.x,i.yBot)}if(jr.length||n&&n.scrollTop!=null)r=Zt(jr,!0,n&&n.scrollTop);r||(Ir&&rn(),qr&&nn()),n&&Jt(),Ir&&Xn(),Cr&&(Hr===!0||Hr!==!1&&Ir)&&Vt(Br),Ir&&tr.matchBrackets&&setTimeout(Zn(function(){Vr&&(Vr(),Vr=null),R(kr.from,kr.to)&&Vn(!1)}),20);var s=Ir,o=Rr;Fr&&tr.onChange&&ni&&tr.onChange(ni,Fr),s&&tr.onCursorActivity&&tr.onCursorActivity(ni);for(var u=0;u<o.length;++u)o[u](ni);r&&tr.onUpdate&&tr.onUpdate(ni)}function Zn(e){return function(){pi++||Gn();try{var t=e.apply(this,arguments)}finally{--pi||Yn()}return t}}function er(e){Yr.startCompound();try{return e()}finally{Yr.endCompound()}}var tr={},nr=e.defaults;for(var rr in nr)nr.hasOwnProperty(rr)&&(tr[rr]=(u&&u.hasOwnProperty(rr)?u:nr)[rr]);var ir=W("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em");ir.setAttribute("wrap","off"),ir.setAttribute("autocorrect","off"),ir.setAttribute("autocapitalize","off");var sr=W("div",[ir],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),or=W("div",null,"CodeMirror-scrollbar-inner"),ur=W("div",[or],"CodeMirror-scrollbar"),ar=W("div"),fr=W("div",null,null,"position: relative; z-index: -1"),lr=W("pre","","CodeMirror-cursor"),cr=W("pre","","CodeMirror-cursor","visibility: hidden"),hr=W("div",null,null,"position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden;"),pr=W("div",[hr,lr,cr,fr,ar],null,"position: relative; z-index: 0"),dr=W("div",null,"CodeMirror-gutter-text"),vr=W("div",[dr],"CodeMirror-gutter"),mr=W("div",[vr,W("div",[pr],"CodeMirror-lines")],null,"position: relative"),gr=W("div",[mr],null,"position: relative"),yr=W("div",[gr],"CodeMirror-scroll");yr.setAttribute("tabIndex","-1");var br=W("div",[sr,ur,yr],"CodeMirror"+(tr.lineWrapping?" CodeMirror-wrap":""));o.appendChild?o.appendChild(br):o(br),xn(),Tn(),G&&(ir.style.width="0px"),ct||(yr.draggable=!0),pr.style.outline="none",tr.tabindex!=null&&(ir.tabIndex=tr.tabindex),tr.autofocus&&$t(),!tr.gutter&&!tr.lineNumbers&&(vr.style.display="none"),vt&&(sr.style.height="1px",sr.style.position="absolute"),mt?(ur.style.zIndex=-2,ur.style.visibility="hidden"):at&&(ur.style.minWidth="18px");var wr=new P,Er=new P,Sr,xr,Tr=new b([new y([new g("")])]),Nr=0,Cr;wn();var kr={from:{line:0,ch:0},to:{line:0,ch:0},inverted:!1},Lr,Ar,Or,Mr=0,_r,Dr=!1,Pr=!1,Hr,Br,jr,Fr,Ir,qr,Rr,Ur=0,zr=0,Wr=0,Xr=0,Vr,$r=v(0),Jr=!1,Kr=!0,Qr=!1,Gr=null;Zn(function(){L(tr.value||""),Hr=!1})();var Yr=new T;D(yr,"mousedown",Zn(et)),D(yr,"dblclick",Zn(tt)),D(pr,"selectstart",k),ot||D(yr,"contextmenu",Wn),D(yr,"scroll",Z),D(ur,"scroll",$),D(ur,"mousedown",function(){Cr&&setTimeout($t,0)});var Zr=D(window,"resize",function(){br.parentNode?Zt(!0):Zr()},!0);D(ir,"keyup",Zn(kt)),D(ir,"input",Wt),D(ir,"keydown",Zn(St)),D(ir,"keypress",Zn(Ct)),D(ir,"focus",Lt),D(ir,"blur",At),tr.dragDrop&&(D(yr,"dragstart",ht),D(yr,"dragenter",f),D(yr,"dragover",f),D(yr,"drop",Zn(rt))),D(yr,"paste",function(){$t(),Wt()}),D(ir,"paste",Wt),D(ir,"cut",Zn(function(){tr.readOnly||It("")})),vt&&D(gr,"mouseup",function(){document.activeElement==ir&&ir.blur(),$t()});var ei;try{ei=document.activeElement==ir}catch(ti){}ei||tr.autofocus?setTimeout(Lt,20):At();var ni=br.CodeMirror={getValue:H,setValue:Zn(L),getSelection:Ut,replaceSelection:Zn(It),focus:function(){window.focus(),$t(),Lt(),Wt()},setOption:function(e,t){var n=tr[e];tr[e]=t,e=="mode"||e=="indentUnit"?wn():e=="readOnly"&&t=="nocursor"?(At(),ir.blur()):e=="readOnly"&&!t?Vt(!0):e=="theme"?xn():e=="lineWrapping"&&n!=t?Zn(Sn)():e=="tabSize"?Zt(!0):e=="keyMap"&&Tn();if(e=="lineNumbers"||e=="gutter"||e=="firstLineNumber"||e=="theme"||e=="lineNumberFormatter")En(),Zt(!0)},getOption:function(e){return tr[e]},getMode:function(){return xr},undo:Zn(_t),redo:Zn(Dt),indentLine:Zn(function(e,t){typeof t!="string"&&(t==null?t=tr.smartIndent?"smart":"prev":t=t?"add":"subtract"),l(e)&&bn(e,t)}),indentSelection:Zn(yn),historySize:function(){return{undo:Yr.done.length,redo:Yr.undone.length}},clearHistory:function(){Yr=new T},setHistory:function(e){Yr=new T,Yr.done=e.done,Yr.undone=e.undone},getHistory:function(){function e(e){for(var t=0,n=[],r;t<e.length;++t){n.push(r=[]);for(var i=0,s=e[t];i<s.length;++i){var o=[],u=s[i];r.push({start:u.start,added:u.added,old:o});for(var a=0;a<u.old.length;++a)o.push(h(u.old[a]))}}return n}return{done:e(Yr.done),undone:e(Yr.undone)}},matchBrackets:Zn(function(){Vn(!0)}),getTokenAt:Zn(function(e){return e=cn(e),v(e.line).getTokenAt(xr,Jn(e.line),tr.tabSize,e.ch)}),getStateAfter:function(e){return e=ln(e==null?Tr.size-1:e),Jn(e+1)},cursorCoords:function(e,t){return e==null&&(e=kr.inverted),this.charCoords(e?kr.from:kr.to,t)},charCoords:function(e,t){return e=cn(e),t=="local"?Bn(e,!1):t=="div"?Bn(e,!0):Fn(e)},coordsChar:function(e){var t=B(pr);return jn(e.x-t.left,e.y-t.top)},markText:Zn(Cn),setBookmark:kn,findMarksAt:Ln,setMarker:Zn(An),clearMarker:Zn(On),setLineClass:Zn(_n),hideLine:Zn(function(e){return Dn(e,!0)}),showLine:Zn(function(e){return Dn(e,!1)}),onDeleteLine:function(e,t){if(typeof e=="number"){if(!l(e))return null;e=v(e)}return(e.handlers||(e.handlers=[])).push(t),e},lineInfo:Pn,getViewport:function(){return{from:zr,to:Wr}},addWidget:function(e,t,n,r,i){e=Bn(cn(e));var s=e.yBot,o=e.x;t.style.position="absolute",gr.appendChild(t);if(r=="over")s=e.y;else if(r=="near"){var u=Math.max(yr.offsetHeight,Tr.height*In()),a=Math.max(gr.clientWidth,pr.clientWidth)-Un();e.yBot+t.offsetHeight>u&&e.y>t.offsetHeight&&(s=e.y-t.offsetHeight),o+t.offsetWidth>a&&(o=a-t.offsetWidth)}t.style.top=s+Rn()+"px",t.style.left=t.style.right="",i=="right"?(o=gr.clientWidth-t.offsetWidth,t.style.right="0px"):(i=="left"?o=0:i=="middle"&&(o=(gr.clientWidth-t.offsetWidth)/2),t.style.left=o+Un()+"px"),n&&Qt(o,s,o+t.offsetWidth,s+t.offsetHeight)},lineCount:function(){return Tr.size},clipPos:cn,getCursor:function(e){return e==null&&(e=kr.inverted),z(e?kr.from:kr.to)},somethingSelected:function(){return!R(kr.from,kr.to)},setCursor:Zn(function(e,t,n){t==null&&typeof e.line=="number"?fn(e.line,e.ch,n):fn(e,t,n)}),setSelection:Zn(function(e,t,n){(n?on:un)(cn(e),cn(t||e))}),getLine:function(e){if(l(e))return v(e).text},getLineHandle:function(e){if(l(e))return v(e)},setLine:Zn(function(e,t){l(e)&&Ft(t,{line:e,ch:0},{line:e,ch:v(e).text.length})}),removeLine:Zn(function(e){l(e)&&Ft("",{line:e,ch:0},cn({line:e+1,ch:0}))}),replaceRange:Zn(Ft),getRange:function(e,t,n){return Rt(cn(e),cn(t),n)},triggerOnKeyDown:Zn(St),execCommand:function(e){return it[e](ni)},moveH:Zn(pn),deleteH:Zn(dn),moveV:Zn(vn),toggleOverwrite:function(){Dr?(Dr=!1,lr.className=lr.className.replace(" CodeMirror-overwrite","")):(Dr=!0,lr.className+=" CodeMirror-overwrite")},posFromIndex:function(e){var t=0,n;return Tr.iter(0,Tr.size,function(r){var i=r.text.length+1;if(i>e)return n=e,!0;e-=i,++t}),cn({line:t,ch:n})},indexFromPos:function(e){if(e.line<0||e.ch<0)return 0;var t=e.ch;return Tr.iter(0,e.line,function(e){t+=e.text.length+1}),t},scrollTo:function(e,t){e!=null&&(yr.scrollLeft=e),t!=null&&(ur.scrollTop=yr.scrollTop=t),Zt([])},getScrollInfo:function(){return{x:yr.scrollLeft,y:ur.scrollTop,height:ur.scrollHeight,width:yr.scrollWidth}},setSize:function(e,t){function n(e){return e=String(e),/^\d+$/.test(e)?e+"px":e}e!=null&&(br.style.width=n(e)),t!=null&&(yr.style.height=n(t)),ni.refresh()},operation:function(e){return Zn(e)()},compoundChange:function(e){return er(e)},refresh:function(){Zt(!0,null,Mr),ur.scrollHeight>Mr&&(ur.scrollTop=Mr)},getInputField:function(){return ir},getWrapperElement:function(){return br},getScrollerElement:function(){return yr},getGutterElement:function(){return vr}},ri,ii=null,si="";Nn.prototype.clear=Zn(function(){var e=Infinity,t=-Infinity;for(var n=0;n<this.lines.length;++n){var r=this.lines[n],i=a(r.markedSpans,this,!0);if(i.from!=null||i.to!=null){var s=E(r);e=Math.min(e,s),t=Math.max(t,s)}}e!=Infinity&&jr.push({from:e,to:t+1}),this.lines.length=0}),Nn.prototype.find=function(){var e,t;for(var n=0;n<this.lines.length;++n){var r=this.lines[n],i=a(r.markedSpans,this);if(i.from!=null||i.to!=null){var s=E(r);i.from!=null&&(e={line:s,ch:i.from}),i.to!=null&&(t={line:s,ch:i.to})}}return this.type=="bookmark"?e:e&&{from:e,to:t}};var oi,ui,ai,fi,li=0,ci,hi={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},pi=0;for(var di in nt)nt.propertyIsEnumerable(di)&&!ni.propertyIsEnumerable(di)&&(ni[di]=nt[di]);return ni}function t(e){return typeof e=="string"?st[e]:e}function n(e,n,r,i,s){function o(n){n=t(n);var r=n[e];if(r===!1)return s&&s(),!0;if(r!=null&&i(r))return!0;if(n.nofallthrough)return s&&s(),!0;var u=n.fallthrough;if(u==null)return!1;if(Object.prototype.toString.call(u)!="[object Array]")return o(u);for(var a=0,f=u.length;a<f;++a)if(o(u[a]))return!0;return!1}return n&&o(n)?!0:o(r)}function r(e){var t=Nt[_(e,"keyCode")];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function i(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var n={};for(var r in t){var i=t[r];i instanceof Array&&(i=i.concat([])),n[r]=i}return n}function s(e,t,n){return e.startState?e.startState(t,n):!0}function o(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8}function u(e,t,n){this.from=e,this.to=t,this.marker=n}function a(e,t,n){if(e)for(var r=0;r<e.length;++r){var i=e[r];if(i.marker==t)return n&&e.splice(r,1),i}}function f(e,t,n){if(e)for(var r=0,i;r<e.length;++r){var s=e[r],o=s.marker,u=s.from==null||(o.inclusiveLeft?s.from<=t:s.from<t);if(u||o.type=="bookmark"&&s.from==t&&s.from!=n){var a=s.to==null||(o.inclusiveRight?s.to>=t:s.to>t);(i||(i=[])).push({from:s.from,to:a?null:s.to,marker:o})}}return i}function l(e,t){if(e)for(var n=0,r;n<e.length;++n){var i=e[n],s=i.marker,o=i.to==null||(s.inclusiveRight?i.to>=t:i.to>t);if(o||s.type=="bookmark"&&i.from==t){var u=i.from==null||(s.inclusiveLeft?i.from<=t:i.from<t);(r||(r=[])).push({from:u?null:i.from-t,to:i.to==null?null:i.to-t,marker:s})}}return r}function c(e,t,n,r,i){if(!e&&!t)return i;var s=f(e,n),o=l(t,r),u=i.length==1,c=I(i).length+(u?n:0);if(s)for(var h=0;h<s.length;++h){var p=s[h];if(p.to==null){var v=a(o,p.marker);v?u&&(p.to=v.to==null?null:v.to+c):p.to=n}}if(o)for(var h=0;h<o.length;++h){var p=o[h];p.to!=null&&(p.to+=c);if(p.from==null){var v=a(s,p.marker);v||(p.from=c,u&&(s||(s=[])).push(p))}else p.from+=c,u&&(s||(s=[])).push(p)}var m=[d(i[0],s)];if(!u){var g=i.length-2,y;if(g>0&&s)for(var h=0;h<s.length;++h)s[h].to==null&&(y||(y=[])).push({from:null,to:null,marker:s[h].marker});for(var h=0;h<g;++h)m.push(d(i[h+1],y));m.push(d(I(i),o))}return m}function h(e){return typeof e=="string"?e:e.text}function p(e){return typeof e=="string"?null:e.markedSpans}function d(e,t){return t?{text:e,markedSpans:t}:e}function v(e){var t=e.markedSpans;if(!t)return;for(var n=0;n<t.length;++n){var r=t[n].marker.lines,i=K(r,e);r.splice(i,1)}e.markedSpans=null}function m(e,t){if(!t)return;for(var n=0;n<t.length;++n)var r=t[n].marker.lines.push(e);e.markedSpans=t}function g(e,t){this.text=e,this.height=1,m(this,t)}function y(e){this.lines=e,this.parent=null;for(var t=0,n=e.length,r=0;t<n;++t)e[t].parent=this,r+=e[t].height;this.height=r}function b(e){this.children=e;var t=0,n=0;for(var r=0,i=e.length;r<i;++r){var s=e[r];t+=s.chunkSize(),n+=s.height,s.parent=this}this.size=t,this.height=n,this.parent=null}function w(e,t){while(!e.lines)for(var n=0;;++n){var r=e.children[n],i=r.chunkSize();if(t<i){e=r;break}t-=i}return e.lines[t]}function E(e){if(e.parent==null)return null;var t=e.parent,n=K(t.lines,e);for(var r=t.parent;r;t=r,r=r.parent)for(var i=0,s=r.children.length;;++i){if(r.children[i]==t)break;n+=r.children[i].chunkSize()}return n}function S(e,t){var n=0;e:do{for(var r=0,i=e.children.length;r<i;++r){var s=e.children[r],o=s.height;if(t<o){e=s;continue e}t-=o,n+=s.chunkSize()}return n}while(!e.lines);for(var r=0,i=e.lines.length;r<i;++r){var u=e.lines[r],a=u.height;if(t<a)break;t-=a}return n+r}function x(e,t){var n=0;e:do{for(var r=0,i=e.children.length;r<i;++r){var s=e.children[r],o=s.chunkSize();if(t<o){e=s;continue e}t-=o,n+=s.height}return n}while(!e.lines);for(var r=0;r<t;++r)n+=e.lines[r].height;return n}function T(){this.time=0,this.done=[],this.undone=[],this.compound=0,this.closed=!1}function N(){A(this)}function C(e){return e.stop||(e.stop=N),e}function k(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function L(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function A(e){k(e),L(e)}function O(e){return e.target||e.srcElement}function M(e){var t=e.which;return t==null&&(e.button&1?t=1:e.button&2?t=3:e.button&4&&(t=2)),Y&&e.ctrlKey&&t==1&&(t=3),t}function _(e,t){var n=e.override&&e.override.hasOwnProperty(t);return n?e.override[t]:e[t]}function D(e,t,n,r){if(typeof e.addEventListener=="function"){e.addEventListener(t,n,!1);if(r)return function(){e.removeEventListener(t,n,!1)}}else{var i=function(e){n(e||window.event)};e.attachEvent("on"+t,i);if(r)return function(){e.detachEvent("on"+t,i)}}}function P(){this.id=null}function H(e,t,n){t==null&&(t=e.search(/[^\s\u00a0]/),t==-1&&(t=e.length));for(var r=0,i=0;r<t;++r)e.charAt(r)=="	"?i+=n-i%n:++i;return i}function B(e,t){try{var n=e.getBoundingClientRect();n={top:n.top,left:n.left}}catch(r){n={top:0,left:0}}if(!t)if(window.pageYOffset==null){var i=document.documentElement||document.body.parentNode;i.scrollTop==null&&(i=document.body),n.top+=i.scrollTop,n.left+=i.scrollLeft}else n.top+=window.pageYOffset,n.left+=window.pageXOffset;return n}function j(e){return e.textContent||e.innerText||e.nodeValue||""}function F(e){while(St.length<=e)St.push(I(St)+" ");return St[e]}function I(e){return e[e.length-1]}function q(e){G?(e.selectionStart=0,e.selectionEnd=e.value.length):e.select()}function R(e,t){return e.line==t.line&&e.ch==t.ch}function U(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function z(e){return{line:e.line,ch:e.ch}}function W(e,t,n,r){var i=document.createElement(e);n&&(i.className=n),r&&(i.style.cssText=r);if(typeof t=="string")$(i,t);else if(t)for(var s=0;s<t.length;++s)i.appendChild(t[s]);return i}function X(e){return e.innerHTML="",e}function V(e,t){X(e).appendChild(t)}function $(e,t){ft?(e.innerHTML="",e.appendChild(document.createTextNode(t))):e.textContent=t}function J(e,t){if(!t)return 0;if(!e)return t.length;for(var n=e.length,r=t.length;n>=0&&r>=0;--n,--r)if(e.charAt(n)!=t.charAt(r))break;return r+1}function K(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;++n)if(e[n]==t)return n;return-1}function Q(e){return/\w/.test(e)||e.toUpperCase()!=e.toLowerCase()}e.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:!1,smartIndent:!0,tabSize:4,keyMap:"default",extraKeys:null,electricChars:!0,autoClearEmptyLines:!1,onKeyEvent:null,onDragEvent:null,lineWrapping:!1,lineNumbers:!1,gutter:!1,fixedGutter:!1,firstLineNumber:1,readOnly:!1,dragDrop:!0,onChange:null,onCursorActivity:null,onViewportChange:null,onGutterClick:null,onUpdate:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:!1,cursorBlinkRate:530,workTime:100,workDelay:200,pollInterval:100,undoDepth:40,tabindex:null,autofocus:null,lineNumberFormatter:function(e){return e}};var G=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Y=G||/Mac/.test(navigator.platform),Z=/Win/.test(navigator.platform),et=e.modes={},tt=e.mimeModes={};e.defineMode=function(t,n){!e.defaults.mode&&t!="null"&&(e.defaults.mode=t);if(arguments.length>2){n.dependencies=[];for(var r=2;r<arguments.length;++r)n.dependencies.push(arguments[r])}et[t]=n},e.defineMIME=function(e,t){tt[e]=t},e.resolveMode=function(t){if(typeof t=="string"&&tt.hasOwnProperty(t))t=tt[t];else if(typeof t=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return typeof t=="string"?{name:t}:t||{name:"null"}},e.getMode=function(t,n){var n=e.resolveMode(n),r=et[n.name];if(!r)return e.getMode(t,"text/plain");var i=r(t,n);if(rt.hasOwnProperty(n.name)){var s=rt[n.name];for(var o in s)s.hasOwnProperty(o)&&(i[o]=s[o])}return i.name=n.name,i},e.listModes=function(){var e=[];for(var t in et)et.propertyIsEnumerable(t)&&e.push(t);return e},e.listMIMEs=function(){var e=[];for(var t in tt)tt.propertyIsEnumerable(t)&&e.push({mime:t,mode:tt[t]});return e};var nt=e.extensions={};e.defineExtension=function(e,t){nt[e]=t};var rt=e.modeExtensions={};e.extendMode=function(e,t){var n=rt.hasOwnProperty(e)?rt[e]:rt[e]={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])};var it=e.commands={selectAll:function(e){e.setSelection({line:0,ch:0},{line:e.lineCount()-1})},killLine:function(e){var t=e.getCursor(!0),n=e.getCursor(!1),r=!R(t,n);!r&&e.getLine(t.line).length==t.ch?e.replaceRange("",t,{line:t.line+1,ch:0}):e.replaceRange("",t,r?n:{line:t.line})},deleteLine:function(e){var t=e.getCursor().line;e.replaceRange("",{line:t,ch:0},{line:t})},undo:function(e){e.undo()},redo:function(e){e.redo()},goDocStart:function(e){e.setCursor(0,0,!0)},goDocEnd:function(e){e.setSelection({line:e.lineCount()-1},null,!0)},goLineStart:function(e){e.setCursor(e.getCursor().line,0,!0)},goLineStartSmart:function(e){var t=e.getCursor(),n=e.getLine(t.line),r=Math.max(0,n.search(/\S/));e.setCursor(t.line,t.ch<=r&&t.ch?0:r,!0)},goLineEnd:function(e){e.setSelection({line:e.getCursor().line},null,!0)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goWordRight:function(e){e.moveH(1,"word")},delCharLeft:function(e){e.deleteH(-1,"char")},delCharRight:function(e){e.deleteH(1,"char")},delWordLeft:function(e){e.deleteH(-1,"word")},delWordRight:function(e){e.deleteH(1,"word")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	","end")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("	","end")},transposeChars:function(e){var t=e.getCursor(),n=e.getLine(t.line);t.ch>0&&t.ch<n.length-1&&e.replaceRange(n.charAt(t.ch)+n.charAt(t.ch-1),{line:t.line,ch:t.ch-1},{line:t.line,ch:t.ch+1})},newlineAndIndent:function(e){e.replaceSelection("\n","end"),e.indentLine(e.getCursor().line)},toggleOverwrite:function(e){e.toggleOverwrite()}},st=e.keyMap={};st.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharRight",Backspace:"delCharLeft",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},st.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordLeft","Ctrl-Delete":"delWordRight","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},st.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordLeft","Ctrl-Alt-Backspace":"delWordRight","Alt-Delete":"delWordRight","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]},st["default"]=Y?st.macDefault:st.pcDefault,st.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageUp","Shift-Ctrl-V":"goPageDown","Ctrl-D":"delCharRight","Ctrl-H":"delCharLeft","Alt-D":"delWordRight","Alt-Backspace":"delWordLeft","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},e.fromTextArea=function(t,n){function r(){t.value=a.getValue()}n||(n={}),n.value=t.value,!n.tabindex&&t.tabindex&&(n.tabindex=t.tabindex);if(n.autofocus==null){var i=document.body;try{i=document.activeElement}catch(s){}n.autofocus=i==t||t.getAttribute("autofocus")!=null&&i==document.body}if(t.form){var o=D(t.form,"submit",r,!0);if(typeof t.form.submit=="function"){var u=t.form.submit;t.form.submit=function f(){r(),t.form.submit=u,t.form.submit(),t.form.submit=f}}}t.style.display="none";var a=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},n);return a.save=r,a.getTextArea=function(){return t},a.toTextArea=function(){r(),t.parentNode.removeChild(a.getWrapperElement()),t.style.display="",t.form&&(o(),typeof t.form.submit=="function"&&(t.form.submit=u))},a};var ot=/gecko\/\d{7}/i.test(navigator.userAgent),ut=/MSIE \d/.test(navigator.userAgent),at=/MSIE [1-7]\b/.test(navigator.userAgent),ft=/MSIE [1-8]\b/.test(navigator.userAgent),lt=ut&&document.documentMode==5,ct=/WebKit\//.test(navigator.userAgent),ht=/Chrome\//.test(navigator.userAgent),pt=/Opera\//.test(navigator.userAgent),dt=/Apple Computer/.test(navigator.vendor),vt=/KHTML\//.test(navigator.userAgent),mt=/Mac OS X 10\D([7-9]|\d\d)\D/.test(navigator.userAgent);e.copyState=i,e.startState=s,e.innerMode=function(e,t){while(e.innerMode){var n=e.innerMode(t);t=n.state,e=n.mode}return n||{mode:e,state:t}},o.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)||undefined},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if(typeof e=="string")var n=t==e;else var n=t&&(e.test?e.test(t):e(t));if(n)return++this.pos,t},eatWhile:function(e){var t=this.pos;while(this.eat(e));return this.pos>t},eatSpace:function(){var e=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},backUp:function(e){this.pos-=e},column:function(){return H(this.string,this.start,this.tabSize)},indentation:function(){return H(this.string,null,this.tabSize)},match:function(e,t,n){if(typeof e!="string"){var r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&t!==!1&&(this.pos+=r[0].length),r)}var i=function(e){return n?e.toLowerCase():e};if(i(this.string).indexOf(i(e),this.pos)==this.pos)return t!==!1&&(this.pos+=e.length),!0},current:function(){return this.string.slice(this.start,this.pos)}},e.StringStream=o;var gt=" ";ot||ut&&!at?gt="":pt&&(gt=""),g.prototype={update:function(e,t){this.text=e,this.stateAfter=this.styles=null,v(this),m(this,t)},highlight:function(e,t,n){var r=new o(this.text,n),i=this.styles||(this.styles=[]),s=i.length=0;this.text==""&&e.blankLine&&e.blankLine(t);while(!r.eol()){var u=e.token(r,t),a=r.current();r.start=r.pos,s&&i[s-1]==u?i[s-2]+=a:a&&(i[s++]=a,i[s++]=u);if(r.pos>5e3){i[s++]=this.text.slice(r.pos),i[s++]=null;break}}},process:function(e,t,n){var r=new o(this.text,n);this.text==""&&e.blankLine&&e.blankLine(t);while(!r.eol()&&r.pos<=5e3)e.token(r,t),r.start=r.pos},getTokenAt:function(e,t,n,r){var i=this.text,s=new o(i,n);while(s.pos<r&&!s.eol()){s.start=s.pos;var u=e.token(s,t)}return{start:s.start,end:s.pos,string:s.current(),className:u||null,state:t}},indentation:function(e){return H(this.text,null,e)},getContent:function(e,t,n){function r(t,n,r){if(!n)return;s&&ut&&n.charAt(0)==" "&&(n=""+n.slice(1)),s=!1;if(!u.test(n)){o+=n.length;var i=document.createTextNode(n)}else{var i=document.createDocumentFragment(),a=0;for(;;){u.lastIndex=a;var f=u.exec(n),l=f?f.index-a:n.length-a;l&&(i.appendChild(document.createTextNode(n.slice(a,a+l))),o+=l);if(!f)break;a+=l+1;if(f[0]=="	"){var c=e-o%e;i.appendChild(W("span",F(c),"cm-tab")),o+=c}else{var h=W("span","","cm-invalidchar");h.title="\\u"+f[0].charCodeAt(0).toString(16),i.appendChild(h),o+=1}}}r?t.appendChild(W("span",[i],r)):t.appendChild(i)}function i(e){return e?"cm-"+e.replace(/ +/g," cm-"):null}var s=!0,o=0,u=/[\t\u0000-\u0019\u200b\u2028\u2029\uFEFF]/g,a=W("pre"),f=r;if(t!=null){var l=0,c=a.anchor=W("span");f=function(e,i,s){var o=i.length;if(t>=l&&t<l+o){t>l&&(r(e,i.slice(0,t-l),s),n&&e.appendChild(W("wbr"))),e.appendChild(c);var u=t-l;r(c,pt?i.slice(u,u+1):i.slice(u),s),pt&&r(e,i.slice(u+1),s),t--,l+=o}else l+=o,r(e,i,s),l==t&&l==v?($(c,gt),e.appendChild(c)):l>t+10&&/\s/.test(i)&&(f=function(){})}}var h=this.styles,p=this.text,d=this.markedSpans,v=p.length;if(!p&&t==null)f(a," ");else if(!d||!d.length)for(var m=0,g=0;g<v;m+=2){var y=h[m],b=h[m+1],w=y.length;g+w>v&&(y=y.slice(0,v-g)),g+=w,f(a,y,i(b))}else{d.sort(function(e,t){return e.from-t.from});var E=0,m=0,S="",b,x=0,T=d[0].from||0,N=[],C=0,k=function(){var e;while(C<d.length&&((e=d[C]).from==E||e.from==null))e.marker.type=="range"&&N.push(e),++C;T=C<d.length?d[C].from:Infinity;for(var t=0;t<N.length;++t){var n=N[t].to;n==null&&(n=Infinity),n==E?N.splice(t--,1):T=Math.min(n,T)}},L=0;while(E<v){T==E&&k();var A=Math.min(v,T);for(;;){if(S){var O=E+S.length,M=b;for(var _=0;_<N.length;++_){var D=N[_];M=(M?M+" ":"")+D.marker.style,D.marker.endStyle&&D.to===Math.min(O,A)&&(M+=" "+D.marker.endStyle),D.marker.startStyle&&D.from===E&&(M+=" "+D.marker.startStyle)}f(a,O>A?S.slice(0,A-E):S,M);if(O>=A){S=S.slice(A-E),E=A;break}E=O}S=h[m++],b=i(h[m++])}}}return a},cleanUp:function(){this.parent=null,v(this)}},y.prototype={chunkSize:function(){return this.lines.length},remove:function(e,t,n){for(var r=e,i=e+t;r<i;++r){var s=this.lines[r];this.height-=s.height,s.cleanUp();if(s.handlers)for(var o=0;o<s.handlers.length;++o)n.push(s.handlers[o])}this.lines.splice(e,t)},collapse:function(e){e.splice.apply(e,[e.length,0].concat(this.lines))},insertHeight:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0,i=t.length;r<i;++r)t[r].parent=this},iterN:function(e,t,n){for(var r=e+t;e<r;++e)if(n(this.lines[e]))return!0}},b.prototype={chunkSize:function(){return this.size},remove:function(e,t,n){this.size-=t;for(var r=0;r<this.children.length;++r){var i=this.children[r],s=i.chunkSize();if(e<s){var o=Math.min(t,s-e),u=i.height;i.remove(e,o,n),this.height-=u-i.height,s==o&&(this.children.splice(r--,1),i.parent=null);if((t-=o)==0)break;e=0}else e-=s}if(this.size-t<25){var a=[];this.collapse(a),this.children=[new y(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0,n=this.children.length;t<n;++t)this.children[t].collapse(e)},insert:function(e,t){var n=0;for(var r=0,i=t.length;r<i;++r)n+=t[r].height;this.insertHeight(e,t,n)},insertHeight:function(e,t,n){this.size+=t.length,this.height+=n;for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<=o){s.insertHeight(e,t,n);if(s.lines&&s.lines.length>50){while(s.lines.length>50){var u=s.lines.splice(s.lines.length-25,25),a=new y(u);s.height-=a.height,this.children.splice(r+1,0,a),a.parent=this}this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(this.children.length<=10)return;var e=this;do{var t=e.children.splice(e.children.length-5,5),n=new b(t);if(!e.parent){var r=new b(e.children);r.parent=e,e.children=[r,n],e=r}else{e.size-=n.size,e.height-=n.height;var i=K(e.parent.children,e);e.parent.children.splice(i+1,0,n)}n.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iter:function(e,t,n){this.iterN(e,t-e,n)},iterN:function(e,t,n){for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<o){var u=Math.min(t,o-e);if(s.iterN(e,u,n))return!0;if((t-=u)==0)break;e=0}else e-=o}}},T.prototype={addChange:function(e,t,n){this.undone.length=0;var r=+(new Date),i=I(this.done),s=i&&I(i),o=r-this.time;if(this.compound&&i&&!this.closed)i.push({start:e,added:t,old:n});else if(o>400||!s||this.closed||s.start>e+n.length||s.start+s.added<e)this.done.push([{start:e,added:t,old:n}]),this.closed=!1;else{var u=Math.max(0,s.start-e),a=Math.max(0,e+n.length-(s.start+s.added));for(var f=u;f>0;--f)s.old.unshift(n[f-1]);for(var f=a;f>0;--f)s.old.push(n[n.length-f]);u&&(s.start=e),s.added+=t-(n.length-u-a)}this.time=r},startCompound:function(){this.compound++||(this.closed=!0)},endCompound:function(){--this.compound||(this.closed=!0)}},e.e_stop=A,e.e_preventDefault=k,e.e_stopPropagation=L,e.connect=D,P.prototype={set:function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)}};var yt=e.Pass={toString:function(){return"CodeMirror.Pass"}},bt=function(){if(ft)return!1;var e=W("div");return"draggable"in e||"dragDrop"in e}(),wt=function(){var e=W("textarea");return e.value="foo\nbar",e.value.indexOf("\r")>-1?"\r\n":"\n"}(),Et=/^$/;ot?Et=/$'/:dt?Et=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:ht&&(Et=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/);var St=[""],xt="\n\nb".split(/\n/).length!=3?function(e){var t=0,n=[],r=e.length;while(t<=r){var i=e.indexOf("\n",t);i==-1&&(i=e.length);var s=e.slice(t,e.charAt(i-1)=="\r"?i-1:i),o=s.indexOf("\r");o!=-1?(n.push(s.slice(0,o)),t+=o+1):(n.push(s),t=i+1)}return n}:function(e){return e.split(/\r\n?|\n/)};e.splitLines=xt;var Tt=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(n){}return!t||t.parentElement()!=e?!1:t.compareEndPoints("StartToEnd",t)!=0};e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null");var Nt={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};return e.keyNames=Nt,function(){for(var e=0;e<10;e++)Nt[e+48]=String(e);for(var e=65;e<=90;e++)Nt[e]=String.fromCharCode(e);for(var e=1;e<=12;e++)Nt[e+111]=Nt[e+63235]="F"+e}(),e.version="2.34",e}(),e.defineMode("css",function(e){function t(e){var t={};for(var n=0;n<e.length;++n)t[e[n]]=!0;return t}function n(e,t){return a=t,e}function r(e,t){var r=e.next();if(r=="@")return e.eatWhile(/[\w\\\-]/),n("def",e.current());if(r=="/"&&e.eat("*"))return t.tokenize=i,i(e,t);if(r=="<"&&e.eat("!"))return t.tokenize=s,s(e,t);if(r=="=")n(null,"compare");else{if(!(r!="~"&&r!="|"||!e.eat("=")))return n(null,"compare");if(r=='"'||r=="'")return t.tokenize=o(r),t.tokenize(e,t);if(r=="#")return e.eatWhile(/[\w\\\-]/),n("atom","hash");if(r=="!")return e.match(/^\s*\w*/),n("keyword","important");if(/\d/.test(r))return e.eatWhile(/[\w.%]/),n("number","unit");if(r!=="-")return/[,+>*\/]/.test(r)?n(null,"select-op"):r=="."&&e.match(/^\w+/)?n("qualifier",a):r==":"?n("operator",r):/[;{}\[\]\(\)]/.test(r)?n(null,r):(e.eatWhile(/[\w\\\-]/),n("property","variable"));if(/\d/.test(e.peek()))return e.eatWhile(/[\w.%]/),n("number","unit");if(e.match(/^[^-]+-/))return n("meta",a)}}function i(e,t){var i=!1,s;while((s=e.next())!=null){if(i&&s=="/"){t.tokenize=r;break}i=s=="*"}return n("comment","comment")}function s(e,t){var i=0,s;while((s=e.next())!=null){if(i>=2&&s==">"){t.tokenize=r;break}i=s=="-"?i+1:0}return n("comment","comment")}function o(e){return function(t,i){var s=!1,o;while((o=t.next())!=null){if(o==e&&!s)break;s=!s&&o=="\\"}return s||(i.tokenize=r),n("string","string")}}var u=e.indentUnit,a,f=t(["all","aural","braille","handheld","print","projection","screen","tty","tv","embossed"]),l=t(["width","min-width","max-width","height","min-height","max-height","device-width","min-device-width","max-device-width","device-height","min-device-height","max-device-height","aspect-ratio","min-aspect-ratio","max-aspect-ratio","device-aspect-ratio","min-device-aspect-ratio","max-device-aspect-ratio","color","min-color","max-color","color-index","min-color-index","max-color-index","monochrome","min-monochrome","max-monochrome","resolution","min-resolution","max-resolution","scan","grid"]),c=t(["align-content","align-items","align-self","alignment-adjust","alignment-baseline","anchor-point","animation","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","float-offset","font","font-feature-settings","font-family","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-weight","grid-cell","grid-column","grid-column-align","grid-column-sizing","grid-column-span","grid-columns","grid-flow","grid-row","grid-row-align","grid-row-sizing","grid-row-span","grid-rows","grid-template","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","justify-content","left","letter-spacing","line-break","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","pitch","pitch-range","play-during","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","size","speak","speak-as","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-outline","text-shadow","text-space-collapse","text-transform","text-underline-position","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","word-break","word-spacing","word-wrap","z-index"]),h=t(["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua"]),p=t(["above","absolute","activeborder","activecaption","afar","after-white-space","ahead","alias","all","all-scroll","alternate","always","amharic","amharic-abegede","antialiased","appworkspace","arabic-indic","armenian","asterisks","auto","avoid","background","backwards","baseline","below","bidi-override","binary","bengali","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break-all","break-word","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","cambodian","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-earthly-branch","cjk-heavenly-stem","cjk-ideographic","clear","clip","close-quote","col-resize","collapse","compact","condensed","contain","content","content-box","context-menu","continuous","copy","cover","crop","cross","crosshair","currentcolor","cursive","dashed","decimal","decimal-leading-zero","default","default-button","destination-atop","destination-in","destination-out","destination-over","devanagari","disc","discard","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipsis","embed","end","ethiopic","ethiopic-abegede","ethiopic-abegede-am-et","ethiopic-abegede-gez","ethiopic-abegede-ti-er","ethiopic-abegede-ti-et","ethiopic-halehame-aa-er","ethiopic-halehame-aa-et","ethiopic-halehame-am-et","ethiopic-halehame-gez","ethiopic-halehame-om-et","ethiopic-halehame-sid-et","ethiopic-halehame-so-et","ethiopic-halehame-ti-er","ethiopic-halehame-ti-et","ethiopic-halehame-tig","ew-resize","expanded","extra-condensed","extra-expanded","fantasy","fast","fill","fixed","flat","footnotes","forwards","from","geometricPrecision","georgian","graytext","groove","gujarati","gurmukhi","hand","hangul","hangul-consonant","hebrew","help","hidden","hide","higher","highlight","highlighttext","hiragana","hiragana-iroha","horizontal","hsl","hsla","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-table","inset","inside","intrinsic","invert","italic","justify","kannada","katakana","katakana-iroha","khmer","landscape","lao","large","larger","left","level","lighter","line-through","linear","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-alpha","lower-armenian","lower-greek","lower-hexadecimal","lower-latin","lower-norwegian","lower-roman","lowercase","ltr","malayalam","match","media-controls-background","media-current-time-display","media-fullscreen-button","media-mute-button","media-play-button","media-return-to-realtime-button","media-rewind-button","media-seek-back-button","media-seek-forward-button","media-slider","media-sliderthumb","media-time-remaining-display","media-volume-slider","media-volume-slider-container","media-volume-sliderthumb","medium","menu","menulist","menulist-button","menulist-text","menulist-textfield","menutext","message-box","middle","min-intrinsic","mix","mongolian","monospace","move","multiple","myanmar","n-resize","narrower","navy","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","nw-resize","nwse-resize","oblique","octal","open-quote","optimizeLegibility","optimizeSpeed","oriya","oromo","outset","outside","overlay","overline","padding","padding-box","painted","paused","persian","plus-darker","plus-lighter","pointer","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radio","read-only","read-write","read-write-plaintext-only","relative","repeat","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","round","row-resize","rtl","run-in","running","s-resize","sans-serif","scroll","scrollbar","se-resize","searchfield","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","semi-condensed","semi-expanded","separate","serif","show","sidama","single","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","solid","somali","source-atop","source-in","source-out","source-over","space","square","square-button","start","static","status-bar","stretch","stroke","sub","subpixel-antialiased","super","sw-resize","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","telugu","text","text-bottom","text-top","textarea","textfield","thai","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","tibetan","tigre","tigrinya-er","tigrinya-er-abegede","tigrinya-et","tigrinya-et-abegede","to","top","transparent","ultra-condensed","ultra-expanded","underline","up","upper-alpha","upper-armenian","upper-greek","upper-hexadecimal","upper-latin","upper-norwegian","upper-roman","uppercase","urdu","url","vertical","vertical-text","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","white","wider","window","windowframe","windowtext","x-large","x-small","xor","xx-large","xx-small","yellow"]);return{startState:function(e){return{tokenize:r,baseIndent:e||0,stack:[]}},token:function(e,t){if(e.eatSpace())return null;var n=t.tokenize(e,t),r=t.stack[t.stack.length-1];return n=="property"?r=="propertyValue"?p[e.current()]?n="string-2":h[e.current()]?n="keyword":n="variable-2":r=="rule"?c[e.current()]||(n+=" error"):!r||r=="@media{"?n="tag":r=="@media"?f[e.current()]?n="attribute":/^(only|not)$/i.test(e.current())?n="keyword":e.current().toLowerCase()=="and"?n="error":l[e.current()]?n="error":n="attribute error":r=="@mediaType"?f[e.current()]?n="attribute":e.current().toLowerCase()=="and"?n="operator":/^(only|not)$/i.test(e.current())?n="error":l[e.current()]?n="error":n="error":r=="@mediaType("?c[e.current()]||(f[e.current()]?n="error":e.current().toLowerCase()=="and"?n="operator":/^(only|not)$/i.test(e.current())?n="error":n+=" error"):n="error":n=="atom"?!r||r=="@media{"?n="builtin":r=="propertyValue"?/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e.current())||(n+=" error"):n="error":r=="@media"&&a=="{"&&(n="error"),a=="{"?r=="@media"||r=="@mediaType"?(t.stack.pop(),t.stack[t.stack.length-1]="@media{"):t.stack.push("rule"):a=="}"?(t.stack.pop(),r=="propertyValue"&&t.stack.pop()):a=="@media"?t.stack.push("@media"):r=="@media"&&/\b(keyword|attribute)\b/.test(n)?t.stack.push("@mediaType"):r=="@mediaType"&&e.current()==","?t.stack.pop():r=="@mediaType"&&a=="("?t.stack.push("@mediaType("):r=="@mediaType("&&a==")"?t.stack.pop():r=="rule"&&a==":"?t.stack.push("propertyValue"):r=="propertyValue"&&a==";"&&t.stack.pop(),n},indent:function(e,t){var n=e.stack.length;return/^\}/.test(t)&&(n-=e.stack[e.stack.length-1]=="propertyValue"?2:1),e.baseIndent+n*u},electricChars:"}"}}),e.defineMIME("text/css","css"),e.defineMode("htmlmixed",function(t){function n(e,t){var n=o.token(e,t.htmlState);return n=="tag"&&e.current()==">"&&t.htmlState.context&&(/^script$/i.test(t.htmlState.context.tagName)?(t.token=i,t.localState=u.startState(o.indent(t.htmlState,""))):/^style$/i.test(t.htmlState.context.tagName)&&(t.token=s,t.localState=a.startState(o.indent(t.htmlState,"")))),n}function r(e,t,n){var r=e.current(),i=r.search(t),s;if(i>-1)e.backUp(r.length-i);else if(s=r.match(/<\/?$/))e.backUp(r[0].length),e.match(t,!1)||e.match(r[0]);return n}function i(e,t){return e.match(/^<\/\s*script\s*>/i,!1)?(t.token=n,t.localState=null,n(e,t)):r(e,/<\/\s*script\s*>/,u.token(e,t.localState))}function s(e,t){return e.match(/^<\/\s*style\s*>/i,!1)?(t.token=n,t.localState=null,n(e,t)):r(e,/<\/\s*style\s*>/,a.token(e,t.localState))}var o=e.getMode(t,{name:"xml",htmlMode:!0}),u=e.getMode(t,"javascript"),a=e.getMode(t,"css");return{startState:function(){var e=o.startState();return{token:n,localState:null,mode:"html",htmlState:e}},copyState:function(t){if(t.localState)var n=e.copyState(t.token==s?a:u,t.localState);return{token:t.token,localState:n,mode:t.mode,htmlState:e.copyState(o,t.htmlState)}},token:function(e,t){return t.token(e,t)},indent:function(e,t){return e.token==n||/^\s*<\//.test(t)?o.indent(e.htmlState,t):e.token==i?u.indent(e.localState,t):a.indent(e.localState,t)},electricChars:"/{}:",innerMode:function(e){var t=e.token==n?o:e.token==i?u:a;return{state:e.localState||e.htmlState,mode:t}}}},"xml","javascript","css"),e.defineMIME("text/html","htmlmixed"),e.defineMode("javascript",function(e,t){function n(e,t,n){return t.tokenize=n,n(e,t)}function r(e,t){var n=!1,r;while((r=e.next())!=null){if(r==t&&!n)return!1;n=!n&&r=="\\"}return n}function i(e,t,n){return q=e,R=n,t}function s(e,t){var s=e.next();if(s=='"'||s=="'")return n(e,t,o(s));if(/[\[\]{}\(\),;\:\.]/.test(s))return i(s);if(s=="0"&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),i("number","number");if(/\d/.test(s)||s=="-"&&e.eat(/\d/))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),i("number","number");if(s=="/")return e.eat("*")?n(e,t,u):e.eat("/")?(e.skipToEnd(),i("comment","comment")):t.reAllowed?(r(e,"/"),e.eatWhile(/[gimy]/),i("regexp","string-2")):(e.eatWhile(I),i("operator",null,e.current()));if(s=="#")return e.skipToEnd(),i("error","error");if(I.test(s))return e.eatWhile(I),i("operator",null,e.current());e.eatWhile(/[\w\$_]/);var a=e.current(),f=F.propertyIsEnumerable(a)&&F[a];return f&&t.kwAllowed?i(f.type,f.style,a):i("variable","variable",a)}function o(e){return function(t,n){return r(t,e)||(n.tokenize=s),i("string","string")}}function u(e,t){var n=!1,r;while(r=e.next()){if(r=="/"&&n){t.tokenize=s;break}n=r=="*"}return i("comment","comment")}function a(e,t,n,r,i,s){this.indented=e,this.column=t,this.type=n,this.prev=i,this.info=s,r!=null&&(this.align=r)}function f(e,t){for(var n=e.localVars;n;n=n.next)if(n.name==t)return!0}function l(e,t,n,r,i){var s=e.cc;z.state=e,z.stream=i,z.marked=null,z.cc=s,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);for(;;){var o=s.length?s.pop():j?w:b;if(o(n,r)){while(s.length&&s[s.length-1].lex)s.pop()();return z.marked?z.marked:n=="variable"&&f(e,r)?"variable-2":t}}}function c(){for(var e=arguments.length-1;e>=0;e--)z.cc.push(arguments[e])}function h(){return c.apply(null,arguments),!0}function p(e){var t=z.state;if(t.context){z.marked="def";for(var n=t.localVars;n;n=n.next)if(n.name==e)return;t.localVars={name:e,next:t.localVars}}}function d(){z.state.context={prev:z.state.context,vars:z.state.localVars},z.state.localVars=W}function v(){z.state.localVars=z.state.context.vars,z.state.context=z.state.context.prev}function m(e,t){var n=function(){var n=z.state;n.lexical=new a(n.indented,z.stream.column(),e,null,n.lexical,t)};return n.lex=!0,n}function g(){var e=z.state;e.lexical.prev&&(e.lexical.type==")"&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function y(e){return function(t){return t==e?h():e==";"?c():h(arguments.callee)}}function b(e){return e=="var"?h(m("vardef"),L,y(";"),g):e=="keyword a"?h(m("form"),w,b,g):e=="keyword b"?h(m("form"),b,g):e=="{"?h(m("}"),k,g):e==";"?h():e=="function"?h(P):e=="for"?h(m("form"),y("("),m(")"),O,y(")"),g,b,g):e=="variable"?h(m("stat"),x):e=="switch"?h(m("form"),w,m("}","switch"),y("{"),k,g,g):e=="case"?h(w,y(":")):e=="default"?h(y(":")):e=="catch"?h(m("form"),d,y("("),H,y(")"),b,g,v):c(m("stat"),w,y(";"),g)}function w(e){return U.hasOwnProperty(e)?h(S):e=="function"?h(P):e=="keyword c"?h(E):e=="("?h(m(")"),E,y(")"),g,S):e=="operator"?h(w):e=="["?h(m("]"),C(w,"]"),g,S):e=="{"?h(m("}"),C(N,"}"),g,S):h()}function E(e){return e.match(/[;\}\)\],]/)?c():c(w)}function S(e,t){if(e=="operator"&&/\+\+|--/.test(t))return h(S);if(e=="operator"&&t=="?")return h(w,y(":"),w);if(e==";")return;if(e=="(")return h(m(")"),C(w,")"),g,S);if(e==".")return h(T,S);if(e=="[")return h(m("]"),w,y("]"),g,S)}function x(e){return e==":"?h(g,b):c(S,y(";"),g)}function T(e){if(e=="variable")return z.marked="property",h()}function N(e){e=="variable"&&(z.marked="property");if(U.hasOwnProperty(e))return h(y(":"),w)}function C(e,t){function n(r){return r==","?h(e,n):r==t?h():h(y(t))}return function(r){return r==t?h():c(e,n)}}function k(e){return e=="}"?h():c(b,k)}function L(e,t){return e=="variable"?(p(t),h(A)):h()}function A(e,t){if(t=="=")return h(w,A);if(e==",")return h(L)}function O(e){return e=="var"?h(L,_):e==";"?c(_):e=="variable"?h(M):c(_)}function M(e,t){return t=="in"?h(w):h(S,_)}function _(e,t){return e==";"?h(D):t=="in"?h(w):h(w,y(";"),D)}function D(e){e!=")"&&h(w)}function P(e,t){if(e=="variable")return p(t),h(P);if(e=="(")return h(m(")"),d,C(H,")"),g,b,v)}function H(e,t){if(e=="variable")return p(t),h()}var B=e.indentUnit,j=t.json,F=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),n=e("keyword b"),r=e("keyword c"),i=e("operator"),s={type:"atom",style:"atom"};return{"if":t,"while":t,"with":t,"else":n,"do":n,"try":n,"finally":n,"return":r,"break":r,"continue":r,"new":r,"delete":r,"throw":r,"var":e("var"),"const":e("var"),let:e("var"),"function":e("function"),"catch":e("catch"),"for":e("for"),"switch":e("switch"),"case":e("case"),"default":e("default"),"in":i,"typeof":i,"instanceof":i,"true":s,"false":s,"null":s,"undefined":s,NaN:s,Infinity:s}}(),I=/[+\-*&%=<>!?|]/,q,R,U={atom:!0,number:!0,variable:!0,string:!0,regexp:!0},z={state:null,column:null,marked:null,cc:null},W={name:"this",next:{name:"arguments"}};return g.lex=!0,{startState:function(e){return{tokenize:s,reAllowed:!0,kwAllowed:!0,cc:[],lexical:new a((e||0)-B,0,"block",!1),localVars:t.localVars,context:t.localVars&&{vars:t.localVars},indented:0}},token:function(e,t){e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation());if(e.eatSpace())return null;var n=t.tokenize(e,t);return q=="comment"?n:(t.reAllowed=q=="operator"||q=="keyword c"||!!q.match(/^[\[{}\(,;:]$/),t.kwAllowed=q!=".",l(t,n,q,R,e))},indent:function(e,t){if(e.tokenize!=s)return 0;var n=t&&t.charAt(0),r=e.lexical;r.type=="stat"&&n=="}"&&(r=r.prev);var i=r.type,o=n==i;return i=="vardef"?r.indented+4:i=="form"&&n=="{"?r.indented:i=="stat"||i=="form"?r.indented+B:r.info=="switch"&&!o?r.indented+(/^(?:case|default)\b/.test(t)?B:2*B):r.align?r.column+(o?0:1):r.indented+(o?0:B)},electricChars:":{}"}}),e.defineMIME("text/javascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMode("xml",function(e,t){function n(e,t){function n(n){return t.tokenize=n,n(e,t)}var i=e.next();if(i=="<"){if(e.eat("!"))return e.eat("[")?e.match("CDATA[")?n(s("atom","]]>")):null:e.match("--")?n(s("comment","-->")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),n(o(1))):null;if(e.eat("?"))return e.eatWhile(/[\w\._\-]/),t.tokenize=s("meta","?>"),"meta";x=e.eat("/")?"closeTag":"openTag",e.eatSpace(),S="";var u;while(u=e.eat(/[^\s\u00a0=<>\"\'\/?]/))S+=u;return t.tokenize=r,"tag"}if(i=="&"){var a;return e.eat("#")?e.eat("x")?a=e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):a=e.eatWhile(/[\d]/)&&e.eat(";"):a=e.eatWhile(/[\w\.\-:]/)&&e.eat(";"),a?"atom":"error"}return e.eatWhile(/[^&<]/),null}function r(e,t){var r=e.next();return r==">"||r=="/"&&e.eat(">")?(t.tokenize=n,x=r==">"?"endTag":"selfcloseTag","tag"):r=="="?(x="equals",null):/[\'\"]/.test(r)?(t.tokenize=i(r),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=<>\"\'\/?]/),"word")}function i(e){return function(t,n){while(!t.eol())if(t.next()==e){n.tokenize=r;break}return"string"}}function s(e,t){return function(r,i){while(!r.eol()){if(r.match(t)){i.tokenize=n;break}r.next()}return e}}function o(e){return function(t,r){var i;while((i=t.next())!=null){if(i=="<")return r.tokenize=o(e+1),r.tokenize(t,r);if(i==">"){if(e==1){r.tokenize=n;break}return r.tokenize=o(e-1),r.tokenize(t,r)}}return"meta"}}function u(){for(var e=arguments.length-1;e>=0;e--)T.cc.push(arguments[e])}function a(){return u.apply(null,arguments),!0}function f(e,t){var n=w.doNotIndent.hasOwnProperty(e)||T.context&&T.context.noIndent;T.context={prev:T.context,tagName:e,indent:T.indented,startOfLine:t,noIndent:n}}function l(){T.context&&(T.context=T.context.prev)}function c(e){if(e=="openTag")return T.tagName=S,a(v,h(T.startOfLine));if(e=="closeTag"){var t=!1;return T.context?T.context.tagName!=S&&(w.implicitlyClosed.hasOwnProperty(T.context.tagName.toLowerCase())&&l(),t=!T.context||T.context.tagName!=S):t=!0,t&&(N="error"),a(p(t))}return a()}function h(e){return function(t){return t=="selfcloseTag"||t=="endTag"&&w.autoSelfClosers.hasOwnProperty(T.tagName.toLowerCase())?(d(T.tagName.toLowerCase()),a()):t=="endTag"?(d(T.tagName.toLowerCase()),f(T.tagName,e),a()):a()}}function p(e){return function(t){return e&&(N="error"),t=="endTag"?(l(),a()):(N="error",a(arguments.callee))}}function d(e){var t;for(;;){if(!T.context)return;t=T.context.tagName.toLowerCase();if(!w.contextGrabbers.hasOwnProperty(t)||!w.contextGrabbers[t].hasOwnProperty(e))return;l()}}function v(e){return e=="word"?(N="attribute",a(m,v)):e=="endTag"||e=="selfcloseTag"?u():(N="error",a(v))}function m(e){return e=="equals"?a(g,v):(w.allowMissing||(N="error"),e=="endTag"||e=="selfcloseTag"?u():a())}function g(e){return e=="string"?a(y):e=="word"&&w.allowUnquoted?(N="string",a()):(N="error",e=="endTag"||e=="selfCloseTag"?u():a())}function y(e){return e=="string"?a(y):u()}var b=e.indentUnit,w=t.htmlMode?{autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0}:{autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1},E=t.alignCDATA,S,x,T,N;return{startState:function(){return{tokenize:n,cc:[],indented:0,startOfLine:!0,tagName:null,context:null}},token:function(e,t){e.sol()&&(t.startOfLine=!0,t.indented=e.indentation());if(e.eatSpace())return null;N=x=S=null;var n=t.tokenize(e,t);t.type=x;if((n||x)&&n!="comment"){T=t;for(;;){var r=t.cc.pop()||c;if(r(x||n))break}}return t.startOfLine=!1,N||n},indent:function(e,t,i){var s=e.context;if(e.tokenize!=r&&e.tokenize!=n||s&&s.noIndent)return i?i.match(/^(\s*)/)[0].length:0;if(E&&/<!\[CDATA\[/.test(t))return 0;s&&/^<\//.test(t)&&(s=s.prev);while(s&&!s.startOfLine)s=s.prev;return s?s.indent+b:0},electricChars:"/"}}),e.defineMIME("text/xml","xml"),e.defineMIME("application/xml","xml"),e.mimeModes.hasOwnProperty("text/html")||e.defineMIME("text/html",{name:"xml",htmlMode:!0}),e}),define("htmlsource/htmlsource-plugin",["require","aloha","ui/ui","ui/button","aloha/plugin","./htmlbeautifier","./codemirror","jquery","jqueryui"],function(e){var t=e("aloha"),n=e("ui/ui"),r=e("ui/button"),i=e("aloha/plugin"),s=e("./htmlbeautifier"),o=e("./codemirror"),u=e("jquery");return e("jqueryui"),i.create("htmlsource",{width:600,height:370,editable:null,editor:null,origContent:null,$dialog:null,defaults:{beautify:!0},init:function(){this.settings=u.extend(!0,this.defaults,this.settings),this.$element=u('<div class="aloha-plugin-htmlsource">'),this.createEditor(),this.createDialog(),this.createButton(),this.subscribeEvents()},subscribeEvents:function(){var e=this;t.bind("aloha-editable-deactivated",function(){e.$dialog.dialog("close")})},createEditor:function(){var e=u("<textarea>");u('<div class="aloha-plugin-htmlsource-container">').append(e).appendTo(this.$element),this.editor=o.fromTextArea(e.get(0),{mode:"text/html",tabMode:"indent",lineWrapping:!0,lineNumbers:!0,onChange:u.proxy(this.onContentChange,this)})},createDialog:function(){var e=this;this.$dialog=this.$element.dialog({title:"HTML Source Editor",dialogClass:"aloha-plugin-htmlsource-dialog",modal:!1,resizable:!0,width:this.width,height:this.height,autoOpen:!1,zIndex:10101,create:u.proxy(this.onCreate,this),open:u.proxy(this.onOpen,this),close:u.proxy(this.onClosed,this),resize:u.proxy(this.onResize,this),resizeStop:u.proxy(this.onResized,this),buttons:{Done:function(){e.$dialog.dialog("close")},Restore:u.proxy(this.onRestore,this)}}),this.$dialog.dialog("widget").bind("mousedown",function(e){e.stopPropagation()}),this.$dialog.dialog("widget").draggable("option",{scroll:!1,containment:"window"}),this.$dialog.dialog("option","position",{my:"center",at:"center",of:window}),this.applyScrollFix()},applyScrollFix:function(){var e=this,t=this.editor.getScrollerElement();this.$dialog.dialog("widget").bind("DOMMouseScroll, mousewheel",function(n){var r,i=e.editor.getScrollInfo();n.type==="DOMMouseScroll"?r=n.originalEvent.detail<0?!0:!1:r=n.originalEvent.wheelDeltaY>0?!0:!1,(r&&i.y===0||!r&&t.clientHeight+i.y>=i.height)&&n.preventDefault()})},createButton:function(){var e=this;n.adopt("htmlsource",r,{tooltip:"Open HTML Source Editor",icon:"aloha-icon aloha-plugin-htmlsource-button",scope:"Aloha.continuoustext",click:function(){e.$dialog.dialog("open")}})},resizeEditor:function(){this.editor.setSize(this.$dialog.width(),this.$dialog.height()),this.editor.refresh()},onCreate:function(e){var t=this;u('<input type="checkbox" name="wraped" id="wraped" checked="checked" /><label for="wraped">Word wrap</label>').click(function(){t.editor.setOption("lineWrapping",u(this).is(":checked"))}).appendTo(u(e.target).parent().find(".ui-dialog-buttonpane"))},onOpen:function(){this.editable=t.getActiveEditable(),t.trigger("aloha-plugin-htmlsource-opened",this.editable),this.origContent=this.getEditableContent(),this.editor.setValue(this.settings.beautify?this.beautifyHtml(this.origContent):this.origContent),this.resizeEditor()},onClosed:function(){t.trigger("aloha-plugin-htmlsource-closed",this.editable)},onResize:function(e,t){this.$dialog.dialog("option","position",[Math.floor(t.position.left)-u(window).scrollLeft(),Math.floor(t.position.top)-u(window).scrollTop()])},onResized:function(){this.resizeEditor()},onRestore:function(){this.$dialog.dialog("close"),this.setEditableContent(this.origContent)},onContentChange:function(){this.setEditableContent(this.editor.getValue())},beautifyHtml:function(e){return s(e,{brace_style:"collapse",break_chained_methods:!1,indent_char:" ",indent_scripts:"normal",indent_size:"4",keep_array_indentation:!1,preserve_newlines:!0,space_after_anon_function:!0,space_before_conditional:!0,unescape_strings:!1})},getEditableContent:function(){return this.editable.obj.html()},setEditableContent:function(e){this.editable.obj.get(0).innerHTML=e,t.trigger("aloha-smart-content-changed",{editable:this.editable,keyIdentifier:null,keyCode:null,"char":null,triggerType:"idle",getSnapshotContent:function(){return e}})}})}),define("reset/reset-plugin",["require","aloha","ui/ui","ui/button","aloha/plugin","aptoma/lib/dom","aptoma/lib/style","jquery"],function(e){var t=e("aloha"),n=e("ui/ui"),r=e("ui/button"),i=e("aloha/plugin"),s=e("aptoma/lib/dom"),o=e("aptoma/lib/style"),u=e("jquery");return i.create("reset",{defaults:{whitelist:{classes:[],styles:[]}},init:function(){this.settings=u.extend(!0,this.defaults,this.settings),this.button=n.adopt("reset",r,{tooltip:"Remove classes & styles from selected text",icon:"aloha-icon aloha-plugin-reset-button",click:u.proxy(this.onButtonClick,this)})},onButtonClick:function(){this.resetStyleForSelection()},resetStyleForSelection:function(){var e=this,n=t.Selection.getRangeObject();if(n.isCollapsed())return;s.recursiveElementCleanup(function(t){u(t).attr("class")?u.each(o.getClassNames(t),function(n,r){e.settings.whitelist.classes.indexOf(r)<0&&o.removeClass(t,r)}):u(t).removeAttr("class"),u(t).attr("style")?u.each(o.getStyles(t,!0),function(n){e.settings.whitelist.styles.indexOf(n)<0&&o.removeStyle(t,n)}):u(t).removeAttr("style")})}})}),define("styles/styles-plugin",["require","aloha","ui/ui","aptoma/lib/ui/menuButton","PubSub","aloha/plugin","aptoma/lib/range","aptoma/lib/css","aptoma/lib/style","aptoma/lib/selection","jquery"],function(e){var t=e("aloha"),n=e("ui/ui"),r=e("aptoma/lib/ui/menuButton"),i=e("PubSub"),s=e("aloha/plugin"),o=e("aptoma/lib/range"),u=e("aptoma/lib/css"),a=e("aptoma/lib/style"),f=e("aptoma/lib/selection"),l=e("jquery");return s.create("styles",{selectionSelectorsMatched:[],cssClassAppliers:{},defaults:{classes:{}},init:function(){var e=this;this.settings=l.extend(!0,this.defaults,this.settings),this.createMenu(),i.sub("aloha.selection.context-change",function(t){e.onSelectionChanged(t.range)})},reset:function(){this.selectionSelectorsMatched=[],this.cssClassAppliers={},this.menuButton&&this.menuButton.element.remove()},createMenu:function(){var e=this,t=[];l.each(this.settings.classes,function(n,r){l.each(r,function(n,r){e.cssClassAppliers[r]=u.createClassApplier(r),t.push({text:n,click:function(){return e.toggleClassName(r),e.updateMenuItems(),!1}})})}),this.menuButton=n.adopt("styles",r,{tooltip:"Toggle CSS classes",menu:t,onShow:l.proxy(this.onMenuShow,this)}),l(this.menuButton.element).addClass("aloha-plugin-styles")},getMatchingSelectors:function(e){return l.map(Object.keys(this.settings.classes),function(t){return l(e).is(t)?t:null})},getActiveClasses:function(){var e=t.Selection.getRangeObject(),n=e.getCommonAncestorContainer();return a.getClassNames(n)},getStyleNameByClass:function(e){var t=null;return l.each(this.settings.classes,function(n,r){l.each(r,function(n,r){e===r&&(t=n)})}),t},onSelectionChanged:function(e){var t=this,n=[];l.each(e.markupEffectiveAtStart,function(e,r){l.merge(n,t.getMatchingSelectors(r))}),this.selectionSelectorsMatched=l.unique(n)},onMenuShow:function(){this.updateMenuItems()},updateMenuItems:function(){var e=this,t=[],n=[],r=this.getActiveClasses();l.each(this.selectionSelectorsMatched,function(n,r){l.merge(t,Object.keys(e.settings.classes[r]))}),l.each(r,function(t,r){n.push(e.getStyleNameByClass(r))}),l(".ui-menu-item",this.menuButton.element).each(function(){var e=l("a",this).text();l(this).toggleClass("ui-state-disabled",t.indexOf(e)<0).toggleClass("tick",n.indexOf(e)>=0)})},toggleClassName:function(e){var n=t.Selection.getRangeObject();if(n.isCollapsed()){var r=o.createExpandedRangeFromCollapsed(n);r&&(f.selectTextFromRange(r),this.cssClassAppliers[e].toggleRange(r))}else this.cssClassAppliers[e].toggleSelection()},updateStyleClasses:function(e){this.reset(),this.settings.classes=e,this.createMenu()}})}),define("textformat/textformat-plugin",["require","aloha","ui/ui","ui/toggleButton","PubSub","aloha/plugin","format/format-plugin","jquery"],function(e){var t=e("aloha"),n=e("ui/ui"),r=e("ui/toggleButton"),i=e("PubSub"),s=e("aloha/plugin"),o=e("format/format-plugin"),u=e("jquery"),a={B:["STRONG","B"],I:["EM","I"],STRONG:["STRONG","B"],EM:["EM","I"]};return s.create("textformat",{init:function(){var e=this;this.buttons={},this.buttons.p=n.adopt("p",r,{tooltip:"Paragraph",icon:"textformat-plugin-icon textformat-plugin-icon-p",click:function(){o.changeMarkup("p")}}),this.buttons.h3=n.adopt("h3",r,{tooltip:"Title",icon:"textformat-plugin-icon textformat-plugin-icon-h3",click:function(){o.changeMarkup("h3")}}),i.sub("aloha.selection.context-change",function(t){e.onSelectionChanged(t.range)})},onSelectionChanged:function(e){u.each(this.buttons,function(n,r){var i=!1,s=n.toUpperCase(),o=a[s]||[s];for(var f=0;f<e.markupEffectiveAtStart.length;f++){var l=e.markupEffectiveAtStart[f];for(var c=0;c<o.length;c++)t.Selection.standardTextLevelSemanticsComparator(l,u("<"+o[c]+">"))&&(r.setState(!0),i=!0)}i||r.setState(!1)})}})}),define("textresize/textresize-plugin",["require","aloha","ui/ui","ui/button","PubSub","aloha/plugin","aptoma/lib/dom","aptoma/lib/css","aptoma/lib/selection","aptoma/lib/range","aptoma/lib/style","jquery"],function(e){function p(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}}function m(e,t){if(e!=="aloha.selection.context-change")return d.call(i,e,t)}function g(e){i.pub=e?m:d}function y(e){return parseFloat(e.toFixed(10))}var t=e("aloha"),n=e("ui/ui"),r=e("ui/button"),i=e("PubSub"),s=e("aloha/plugin"),o=e("aptoma/lib/dom"),u=e("aptoma/lib/css"),a=e("aptoma/lib/selection"),f=e("aptoma/lib/range"),l=e("aptoma/lib/style"),c=e("jquery"),h=window.GENTICS,d=i.pub,v=!1;return s.create("textresize",{buttons:{},spinners:{},cssClassAppliers:{},config:{autoFit:{margin:0},fontSize:{unit:"px",className:null,step:1,page:10,min:10,max:128,value:16},lineHeight:{unit:"em",className:null,step:.1,page:10,min:0,max:3,value:1.2},letterSpacing:{unit:"em",className:null,step:.1,page:10,min:-1,max:3,value:0},wordSpacing:{unit:"em",className:null,step:.1,page:10,min:-1,max:2,value:0}},hotKey:{decreaseFontSize:"ctrl+left ctrl+shift+left",increaseFontSize:"ctrl+right ctrl+shift+right",decreaseLineHeight:"ctrl+up ctrl+shift+up",increaseLineHeight:"ctrl+down ctrl+shift+down",autofitFontSize:"ctrl+space"},init:function(){var e=this;c.each(this.config,function(t){e.settings.config&&e.settings.config[t]&&c.extend(e.config[t],e.settings.config[t])}),c.each(["fontSize","lineHeight","letterSpacing","wordSpacing"],function(t,i){e.buttons[i]=n.adopt(i,r,{"class":"aloha-plugin-textresize-button"}),c(e.buttons[i].element).attr("title","Change text "+i.toLowerCase()),e.cssClassAppliers[i]=u.createClassApplier(e.getStyleClass(i)),e.createSpinner(i,e.config[i],e["change"+i.substr(0,1).toUpperCase()+i.substr(1)])}),this.subscribeEvents(),this.debouncedTriggerSmartContentChange=p(this.triggerSmartContentChange,500)},subscribeEvents:function(){var e=this;i.sub("aloha.selection.context-change",function(n){t.activeEditable&&e.onSelectionChanged(n.range)}),t.bind("aloha-editable-activated",function(t,n){c.each(e.hotKey,function(t,r){n.editable.obj.bind("keydown.aloha.textresize",r,function(n){return g(!0),e[t](n),v=!0,!1}),n.editable.obj.bind("keyup.aloha.textresize",r,function(){v=!1,g(!1),e.triggerSmartContentChange()})}),n.editable.obj.bind("click.aloha.textresize",function(t){if(t.altKey)return e.autofitFontSize(),!1})}),t.bind("aloha-editable-deactivated",function(e,t){t.editable.obj.unbind(".aloha.textresize")})},createSpinner:function(e,t,n){var r=this,i=c('<input class="aloha-plugin-textresize-spinner">').appendTo(c(this.buttons[e].element));this.spinners[e]=i.spinner(c.extend({},t,{stop:function(){n.call(r,c(this).val())}})).keyup(function(){c(this).focus();var t=parseFloat(c(this).val());if(t<r.config[e].min||t>r.config[e].max)return!1}),i.spinner("value",this.config[e].value).spinner("widget").css("height","24px")},onSelectionChanged:function(e){var t=this;c.each(this.getStyles(e),function(e,n){t.spinners[e]&&t.spinners[e].val(n)})},getCurrentValue:function(e,n){var r=t.Selection.getRangeObject(),i=new RegExp("([0-9\\-\\.]+)"+this.config[e].unit),s,o;this.config[e].className&&(s=this.config[e].className.replace("{value}",""));var u=r.findMarkup(function(){return l.hasStyle(this,e)||s&&this.className.indexOf(s)>=0},t.activeEditable.obj);u||(u=r.getCommonAncestorContainer());if(!u)return n;if(this.config[e].className){o=u.className.match(new RegExp(this.config[e].className.replace("{value}","(\\d+)")));if(o)return parseInt(o[1],10)}return o=u.style[e].match(i),o?parseFloat(o[1]):(o=l.getComputedStyle(c(u).get(0),e).match(i),o?parseFloat(o[1]):n)},getStyles:function(){var e=this,t={};return c.each(["fontSize","lineHeight","letterSpacing","wordSpacing"],function(n,r){var i=e.getCurrentValue(r);i&&(t[r]=i)}),t},getStyleClass:function(e){return"tmpStyleClass"+e},changeStyle:function(e,n){var r=this;if(!v){o.elementCleanup(function(t){l.removeStyle(t,e)});var i=t.Selection.getRangeObject(),s=r.getStyleClass(e),u=i.isCollapsed()?f.createExpandedRangeFromCollapsed(i):f.rangeObjectToRangyRange(i);u&&(r.cssClassAppliers[e].applyToRange(u),a.selectTextFromRange(u));var h=c("."+s,t.activeEditable.obj);!h.css(e,n).removeClass(s).attr("class")}else c(t.Selection.getRangeObject().getCommonAncestorContainer()).css(e,n);this.debouncedTriggerSmartContentChange()},changeClass:function(e,n){var r=this,i=this.config[e].className,s=i.replace("{value}",""),h=i.replace("{value}",n);if(!v){o.elementCleanup(function(t){r.replaceClass(c(t),s),l.removeStyle(t,e)});var p=t.Selection.getRangeObject(),d=u.createClassApplier(h),m=p.isCollapsed()?f.createExpandedRangeFromCollapsed(p):f.rangeObjectToRangyRange(p);m&&(d.applyToRange(m),a.selectTextFromRange(m))}else this.replaceClass(c(t.Selection.getRangeObject().getCommonAncestorContainer()),s,h);this.debouncedTriggerSmartContentChange()},replaceClass:function(e,t,n){e.attr("class")&&c.each(e.attr("class").split(" "),function(n,r){r.indexOf(t)>=0&&e.removeClass(r)}),n&&e.addClass(n)},triggerSmartContentChange:function(){function n(){return null===e&&(e=t.activeEditable.getSnapshotContent()),e}var e=null;if(!t.activeEditable)return;t.trigger("aloha-smart-content-changed",{editable:t.activeEditable,keyIdentifier:null,keyCode:null,"char":null,triggerType:"text-resize",getSnapshotContent:n})},changeValue:function(e,t){t>=this.config[e].min&&t<=this.config[e].max&&(this.config[e].className?this.changeClass(e,t):this.changeStyle(e,t+this.config[e].unit),this.spinners[e].val(t))},changeFontSize:function(e){this.changeValue("fontSize",e)},changeLineHeight:function(e){this.changeValue("lineHeight",e)},changeLetterSpacing:function(e){this.changeValue("letterSpacing",e)},changeWordSpacing:function(e){this.changeValue("wordSpacing",e)},decreaseFontSize:function(e){var t=this.config.fontSize.step;e.shiftKey&&(t*=this.config.fontSize.page),this.changeFontSize(y(this.getCurrentValue("fontSize",this.config.fontSize.value)-t))},increaseFontSize:function(e){var t=this.config.fontSize.step;e.shiftKey&&(t*=this.config.fontSize.page),this.changeFontSize(y(this.getCurrentValue("fontSize",this.config.fontSize.value)+t))},decreaseLineHeight:function(e){var t=this.config.lineHeight.step;e.shiftKey&&(t*=this.config.lineHeight.page),this.changeLineHeight(y(this.getCurrentValue("lineHeight",this.config.lineHeight.value)-t))},increaseLineHeight:function(e){var t=this.config.lineHeight.step;e.shiftKey&&(t*=this.config.lineHeight.page),this.changeLineHeight(y(this.getCurrentValue("lineHeight",this.config.lineHeight.value)+t))},autofitFontSize:function(){var e=t.Selection.getRangeObject(),n=c(e.getCommonAncestorContainer()),r=this.config.fontSize.min,i,s,o;e.findMarkup(function(){h.Utils.Dom.isBlockLevelElement(this)&&(n=c(this))},t.activeEditable.obj),i=n.width(),v=!1,this.changeFontSize(r),e=t.Selection.getRangeObject(),o=c(e.getCommonAncestorContainer()),s=o.css("white-space"),o.css("white-space","nowrap"),v=!0;while(o.width()<=i&&++r<=this.config.fontSize.max)this.changeFontSize(r);this.changeFontSize(--r),this.config.autoFit.margin&&this.changeFontSize(r-this.config.autoFit.margin),o.css("white-space",s==="normal"?"":s),v=!1}})});